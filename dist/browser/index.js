import{Plugin as e,Command as t}from"ckeditor5";import{ButtonView as n,createDropdown as o,SplitButtonView as i,MenuBarMenuView as s,MenuBarMenuListView as r,MenuBarMenuListItemView as a,LabeledFieldView as l,createLabeledInputText as c,ListSeparatorView as d,MenuBarMenuListItemButtonView as h}from"ckeditor5";import{Widget as u,toWidget as m}from"ckeditor5";import{env as p}from"ckeditor5";class g{constructor(){}static getInstance(){return g.instance||(g.instance=new g),g.instance}set uiComponent(e){this._uiComponent=e}showError(e){this._uiComponent&&(console.log("Showing error message...",e),this._uiComponent.showGptErrorToolTip(e))}showLoader(e){this._uiComponent&&this._uiComponent.showLoader(e)}hideLoader(){this._uiComponent&&this._uiComponent.hideLoader()}}const f=g.getInstance(),v={"gpt-3.5-turbo":{minOutputTokens:1,maxOutputTokens:4096,maxInputContextTokens:16385},"gpt-4o":{minOutputTokens:0,maxOutputTokens:16384,maxInputContextTokens:128e3},"gpt-4o-mini":{minOutputTokens:1,maxOutputTokens:16384,maxInputContextTokens:128e3},"kavya-m1":{minOutputTokens:0,maxOutputTokens:16384,maxInputContextTokens:128e3}},w=["en","es","hi","nl"],E=["harassment","harassment/threatening","hate","hate/threatening","self-harm","self-harm/instructions","self-harm/intent","sexual","sexual/minors","violence","violence/graphic"],T=[{title:"Edit or review",items:[{title:"Improve Writing",command:"Fix spelling mistakes, use proper grammar and apply good writing practices.\n\t\t\t\t\tDo not lose the original meaning.\nYou must keep the text formatting."},{title:"Make Shorter",command:"Remove any repetitive, redundant, or non-essential writing in this\n\t\t\t\t\tcontent without changing the meaning or losing any key information."},{title:"Make Longer",command:"Improve this content by using descriptive language and inserting\n\t\t\t\t\tmore information and more detailed explanations.\nYou must keep the text formatting."},{title:"Simplify Language",command:"Simplify the writing style of this content and reduce the complexity,\n\t\t\t\t\tso that the content is easy to understand.\nYou must keep the text formatting"}]},{title:"Generate from selection",items:[{title:"Summarize",command:"Summarize this content into one paragraph of text. Include only the key ideas and conclusions.\n\t\t\t\t\tKeep it short. Do not keep original text formatting"},{title:"Continue",command:"Start with the provided content and write at the end of it continuing this topic.\n\t\t\t\t\tKeep the added part short.\nYou must keep the text formatting"}]}],b={blockQuote:"blockquote",caption:"figcaption",codeBlock:"pre",heading1:"h1",heading2:"h2",heading3:"h3",imageBlock:"img",imageInline:"img",paragraph:"p",table:"table",tableCell:"td",tableRow:"tr",$listItem:"li",horizontalLine:"hr"},C={bold:"strong",italic:"em",code:"code",strikethrough:"s",subscript:"sub",superscript:"sup",underline:"u",linkHref:"a"};function y(e){const t=e.model.schema.getDefinitions(),n=Object.keys(t).sort(),o=new Set;n.forEach((e=>{e in b&&o.add(b[e])}));const i=t.$text;return i&&i.allowAttributes&&i.allowAttributes.forEach((e=>{e in C&&o.add(C[e])})),o.has("li")&&(o.add("ul"),o.add("ol")),Array.from(o).sort()}var A,x={},S={endsWithChar:function(e,t){return t.length>1?t.indexOf(e.slice(-1))>-1:e.slice(-1)===t},endsWith:function(e,t){return e.slice(e.length-t.length)===t}},L={},k=["al","adj","assn","Ave","BSc","MSc","Cell","Ch","Co","cc","Corp","Dem","Dept","ed","eg","Eq","Eqs","est","est","etc","Ex","ext","Fig","fig","Figs","figs","i.e","ie","Inc","inc","Jan","Feb","Mar","Apr","Jun","Jul","Aug","Sep","Sept","Oct","Nov","Dec","jr","mi","Miss","Mrs","Mr","Ms","Mol","mt","mts","no","Nos","PhD","MD","BA","MA","MM","pl","pop","pp","Prof","Dr","pt","Ref","Refs","Rep","repr","rev","Sec","Secs","Sgt","Col","Gen","Rep","Sen","Gov","Lt","Maj","Capt","St","Sr","sr","Jr","jr","Rev","Sun","Mon","Tu","Tue","Tues","Wed","Th","Thu","Thur","Thurs","Fri","Sat","trans","Univ","Viz","Vol","vs","v"];L.setAbbreviations=function(e){A=e||k};var P=L.isCapitalized=function(e){return/^[A-Z][a-z].*/.test(e)||R(e)};L.isSentenceStarter=function(e){return P(e)||/``|"|'/.test(e.substring(0,2))},L.isCommonAbbreviation=function(e){var t=e.replace(/[-'`~!@#$%^&*()_|+=?;:'",.<>\{\}\[\]\\\/]/gi,"");return~A.indexOf(t)},L.isTimeAbbreviation=function(e,t){if(("a.m."===e||"p.m."===e)&&"day"===t.replace(/\W+/g,"").slice(-3).toLowerCase())return!0;return!1},L.isDottedAbbreviation=function(e){var t=e.replace(/[\(\)\[\]\{\}]/g,"").match(/(.\.)*/);return t&&t[0].length>0},L.isCustomAbbreviation=function(e){return e.length<=3||P(e)},L.isNameAbbreviation=function(e,t){return t.length>0&&(!!(e<5&&t[0].length<6&&P(t[0]))||t.filter((function(e){return/[A-Z]/.test(e.charAt(0))})).length>=3)};var R=L.isNumber=function(e,t){return t&&(e=e.slice(t-1,t+2)),!isNaN(e)};L.isPhoneNr=function(e){return e.match(/^(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?$/)},L.isURL=function(e){return e.match(/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/)},L.isConcatenated=function(e){var t=0;if(((t=e.indexOf("."))>-1||(t=e.indexOf("!"))>-1||(t=e.indexOf("?"))>-1)&&e.charAt(t+1).match(/[a-zA-Z].*/))return[e.slice(0,t),e.slice(t+1)];return!1},L.isBoundaryChar=function(e){return"."===e||"!"===e||"?"===e};var I=function(e,t){if(("string"==typeof e||e instanceof String)&&"undefined"!=typeof document){var n=document.createElement("DIV");n.innerHTML=e,e=(n.textContent||"").trim()}else"object"==typeof e&&e.textContent&&(e=(e.textContent||"").trim());return e},O=S,_=L,D=" @~@ ",M=D.trim(),N=new RegExp("\\S",""),F=new RegExp("\\n+|[-#=_+*]{4,}","g"),H=new RegExp("\\S+|\\n","g");function $(e){return e.split("\n").map((e=>e.trim())).join("\n")}function G(e,t,n=!1,o){let i="",s=0;const r={preserve_whitespace:!0,html_boundaries:!0,allowed_tags:y(o)},a=x.sentences(e,r),l=n?a.reverse():a;for(const e of l){const o=e.length;if(!((s+o)/4<=t))break;i=n?e+i:i+e,s+=o}return i.trim()}function U(e){if(!e||"string"!=typeof e)return 0;const t=e.trim().replace(/\s+/g," ").match(/\b\w+('\w+)?\b|[.,!?;:"(){}[\]]/g)||[];let n=0;return t.forEach((e=>{e.length>10?n+=Math.ceil(e.length/4):n+=1})),n}function z(e,t){const n=e.split("\n");let o=0,i="";for(const e of n){const n=U(e);if(o+n>t)break;o+=n,i+=e+"\n"}return i}async function V(e){const t=e.trim();if(!/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/i.test(t))throw new Error("Invalid URL");try{const e=`https://r.jina.ai/${t.replace(/[^\x20-\x7E]/g,"").trim()}`,n=await fetch(e.trim(),{headers:{"X-With-Generated-Alt":"true"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const o=await n.text();if(o.includes("Warning: Target URL returned error"))throw new Error(`Target URL (${t}) returned an error`);if(0===o.trim().length)throw new Error("Empty content received");return o.replace(/\(https?:\/\/[^\s]+\)/g,"").replace(/^\s*$/gm,"").trim()}catch(t){return console.error(`Failed to fetch content: ${e}`,t),f.showError("Failed to fetch URL content"),""}}x.sentences=function(e,t){if(!e||"string"!=typeof e||!e.length)return[];if(!N.test(e))return[];var n,o,i={newline_boundaries:!1,html_boundaries:!1,html_boundaries_tags:["p","div","ul","ol"],sanitize:!1,allowed_tags:!1,preserve_whitespace:!1,abbreviations:null};if("boolean"==typeof t)i.newline_boundaries=!0;else for(var s in t)i[s]=t[s];if(_.setAbbreviations(i.abbreviations),i.newline_boundaries&&(e=e.replace(F,D)),i.html_boundaries){var r="(<br\\s*\\/?>|<\\/("+i.html_boundaries_tags.join("|")+")>)",a=new RegExp(r,"g");e=e.replace(a,"$1"+D)}(i.sanitize||i.allowed_tags)&&(i.allowed_tags||(i.allowed_tags=[""]),e=I(e,{allowedTags:i.allowed_tags}));var l=0,c=0,d=[],h=[],u=[];if(!(n=i.preserve_whitespace?(o=e.split(/(<br\s*\/?>|\S+|\n+)/)).filter((function(e,t){return t%2})):e.trim().match(H))||!n.length)return[];for(var m=0,p=n.length;m<p;m++)if(l++,u.push(n[m]),~n[m].indexOf(",")&&(l=0),_.isBoundaryChar(n[m])||O.endsWithChar(n[m],"?!")||n[m]===M)(i.newline_boundaries||i.html_boundaries)&&n[m]===M&&u.pop(),h.push(u),l=0,u=[];else if((O.endsWithChar(n[m],'"')||O.endsWithChar(n[m],"”"))&&(n[m]=n[m].slice(0,-1)),O.endsWithChar(n[m],".")){if(m+1<p){if(2===n[m].length&&isNaN(n[m].charAt(0)))continue;if(_.isCommonAbbreviation(n[m]))continue;if(_.isSentenceStarter(n[m+1])){if(_.isTimeAbbreviation(n[m],n[m+1]))continue;if(_.isNameAbbreviation(l,n.slice(m,6)))continue;if(_.isNumber(n[m+1])&&_.isCustomAbbreviation(n[m]))continue}else{if(O.endsWith(n[m],".."))continue;if(_.isDottedAbbreviation(n[m]))continue;if(_.isNameAbbreviation(l,n.slice(m,5)))continue}}h.push(u),u=[],l=0}else{if((c=n[m].indexOf("."))>-1){if(_.isNumber(n[m],c))continue;if(_.isDottedAbbreviation(n[m]))continue;if(_.isURL(n[m])||_.isPhoneNr(n[m]))continue}(d=_.isConcatenated(n[m]))&&(u.pop(),u.push(d[0]),h.push(u),l=0,(u=[]).push(d[1]))}return u.length&&h.push(u),(h=h.filter((function(e){return e.length>0}))).slice(1).reduce((function(e,t){var n=e[e.length-1];return 1===n.length&&/^.{1,2}[.]$/.test(n[0])&&!/[.]/.test(t[0])?(e.pop(),e.push(n.concat(t)),e):(e.push(t),e)}),[h[0]]).map((function(e,t){if(i.preserve_whitespace&&!i.newline_boundaries&&!i.html_boundaries){var n=2*e.length;return 0===t&&(n+=1),o.splice(0,n).join("")}return e.join(" ")}))};var B={responseRules:"Follow these step-by-step instructions to respond to user inputs:\nIdentify the specific requirements from the TASK section.\nDo not include any markdown syntax in the response.\nGenerate a response that seamlessly integrates with the existing content.\nFormat the response according to the HTML and structural requirements.\nVerify that the response meets all formatting and content guidelines.\nIf there is SELECTED_CONTENT I'll use only that content to answer\nthe user's request in the TASK section, ignoring any additional CONTEXT\nor prior knowledge.",htmlFormatting:"HTML Formatting Requirements:\nGenerate valid HTML snippets only.\nUse only the following allowed tags: ${getAllowedHtmlTags(editor).join(', ')}.\nEnsure proper tag nesting.\nAvoid empty elements.\nUse semantic HTML where appropriate.\nMaintain clean, readable HTML structure.\nFollow block-level element rules.\nProperly close all tags.\nNo inline styles unless specified.\nNo script or style tags.\nThe first word must be a valid HTML tag.\nBlock elements must not contain other block elements.",contentStructure:"Content Structure Rules:\nOrganize information logically.\nUse appropriate paragraph breaks.\nMaintain consistent formatting.\nFollow document hierarchy.\nUse appropriate list structures when needed.\nEnsure proper content flow.\nRespect existing document structure.",tone:"Language and Tone Guidelines:\nMatch the formality level of the surrounding content.\nMaintain a consistent voice throughout the response.\nUse appropriate technical terminology when relevant.\nEnsure proper grammar and punctuation.\nAvoid overly complex sentence structures.\nKeep the tone engaging and reader-friendly.\nAdapt style based on content type.",inlineContent:"Inline Content Specific Rules:\nDetermine content type (list, table, or inline).\nFormat according to content type.\nEnsure seamless integration.\nPreserve existing content flow.\nMaintain proper nesting.",imageHandling:"Image Element Requirements:\nEvery <img> must have src and alt attributes.\nFormat src URLs as: https://placehold.co/600x400?text=[alt_text].\nAlt text must be descriptive and meaningful.",referenceGuidelines:"Use information from provided markdown to generate new text.\nDo not copy content verbatim.\nEnsure natural flow with existing context.\nAvoid markdown formatting in response.\nConsider whole markdown as single source.\nGenerate requested percentage of content.",contextRequirements:'Replace "@@@cursor@@@" with contextually appropriate content.\nReplace ONLY @@@cursor@@@ - surrounding text is READ-ONLY.\nNEVER copy or paraphrase context text.\nVerify zero phrase duplication.\nAnalyze the CONTEXT section thoroughly\nto understand the existing content and its style.\nGenerate a response that seamlessly integrates\nwith the existing content.\nDetermine the appropriate tone and style based\non the context. Ensure the response flows\nnaturally with the existing content.'};function q(e){const t={...B};return t.htmlFormatting=t.htmlFormatting.replace("${getAllowedHtmlTags(editor).join(', ')}",y(e).join(", ")),t}class j{constructor(e,t={}){var n,o,i;this.editor=e;const s=e.config.get("aiAgent");this.contextSize=s.contextSize,this.promptSettings=null!==(n=s.promptSettings)&&void 0!==n?n:{},this.debugMode=null!==(o=s.debugMode)&&void 0!==o&&o,this.editorContextRatio=null!==(i=t.editorContextRatio)&&void 0!==i?i:.3}getSystemPrompt(e=!1){var t,n;const o=q(this.editor);let i="";for(const[s,r]of Object.entries(o)){if("imageHandling"===s&&!y(this.editor).includes("img")||"inlineContent"===s&&!e)continue;const o=s;let a=r;(null===(t=this.promptSettings.overrides)||void 0===t?void 0:t[o])&&(a=this.promptSettings.overrides[o]),(null===(n=this.promptSettings.additions)||void 0===n?void 0:n[o])&&(a+="\n"+this.promptSettings.additions[o]),i+=$(a)+"\n\n"}return this.debugMode&&(console.group("AiAgent System Prompt Debug"),console.log("System Prompt:",i),console.groupEnd()),i}trimContext(e,t=""){var n,o,i,s,r;let a="",l="";const c=null!=t?t:e,d=null===(s=null===(i=null===(o=null===(n=this.editor)||void 0===n?void 0:n.editing)||void 0===o?void 0:o.view)||void 0===i?void 0:i.domRoots)||void 0===s?void 0:s.get("main"),h=null!==(r=null==d?void 0:d.innerText)&&void 0!==r?r:"",u=h.indexOf(c),m=h.indexOf("\n",u),p=-1!==m?m:u+c.length,g=[h.substring(0,p),h.substring(p+1)],f=Math.floor(this.contextSize*this.editorContextRatio);g.length>1&&(g[0].length<g[1].length?(a=G(g[0],f/2,!0,this.editor),l=G(g[1],f-a.length/4,!1,this.editor)):(l=G(g[1],f/2,!1,this.editor),a=G(g[0],f-l.length/4,!0,this.editor)));const v=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");a=a.trim().replace(new RegExp(v.slice(1)),"@@@cursor@@@").replace("/@@@cursor@@@","@@@cursor@@@");return`${a}\n${l}`.trim()}formatFinalPrompt(e,t,n,o,i=!1){this.debugMode&&(console.group("formatFinalPrompt Debug"),console.log("Request:",e),console.log("Context:",t),console.log("MarkDownContents:",o),console.log("IsEditorEmpty:",i));const s=this.editor.locale.contentLanguage,r=[];if(r.push("<TASK>"),r.push(e),r.push("</TASK>"),(null==t?void 0:t.length)&&!n&&(r.push("\n<CONTEXT>"),r.push(t),r.push("</CONTEXT>")),n&&(r.push("<SELECTED_CONTENT>"),r.push(n),r.push("</SELECTED_CONTENT>")),null==o?void 0:o.length){r.push("\n<REFERENCE_CONTENT>");for(const e of o)r.push(`<SOURCE url="${e.url}">\n${e.content}\n</SOURCE>`);r.push("</REFERENCE_CONTENT>"),r.push("\n<REFERENCE_GUIDELINES>"),r.push(this.getComponentContent("referenceGuidelines")),r.push("</REFERENCE_GUIDELINES>")}return i||n||(r.push("\n<CONTEXT_REQUIREMENTS>"),r.push(this.getComponentContent("contextRequirements")),r.push("</CONTEXT_REQUIREMENTS>")),r.push("\n<INSTRUCTIONS>"),r.push(`The response must follow the language code - ${s}.`),r.push("</INSTRUCTIONS>"),this.debugMode&&(console.group("AiAgent Final Prompt Debug"),console.log("Final Prompt:",r.join("\n")),console.groupEnd()),r.map((e=>function(e){return e.split("\n").map((e=>e.trimStart())).join("\n")}(e))).join("\n")}getComponentContent(e){var t,n;let o=q(this.editor)[e];return(null===(t=this.promptSettings.overrides)||void 0===t?void 0:t[e])&&(o=this.promptSettings.overrides[e]),(null===(n=this.promptSettings.additions)||void 0===n?void 0:n[e])&&(o+="\n"+this.promptSettings.additions[e]),$(o)}async generateMarkDownForUrls(e){try{const t=[];for(const n of e)try{const e=await V(n);e&&t.push({content:e,url:n,tokenCount:U(e)})}catch(e){this.debugMode&&console.error(`Failed to fetch content from ${n}:`,e),f.showError(`Failed to fetch content from ${n}`)}return this.allocateTokensToFetchedContent(this.getSystemPrompt(),t)}catch(e){return this.debugMode&&console.error("Error generating markdown content:",e),f.showError("Failed to generate markdown content"),[]}}allocateTokensToFetchedContent(e,t){var n,o,i,s,r,a;const l=null!==(a=null===(r=null===(s=null===(i=null===(o=null===(n=this.editor)||void 0===n?void 0:n.editing)||void 0===o?void 0:o.view)||void 0===i?void 0:i.domRoots)||void 0===s?void 0:s.get("main"))||void 0===r?void 0:r.innerText)&&void 0!==a?a:"",c=Math.min(Math.floor(this.contextSize*this.editorContextRatio),U(l)),d=this.contextSize-c;if(0===d||!t.length)return t;const h=Math.floor(d/t.length);return t.map((e=>({...e,content:z(e.content,h)})))}}class K{constructor(e){var t;this.editor=e,this.model=e.model,this.debugMode=null!==(t=e.config.get("aiAgent.debugMode"))&&void 0!==t&&t}async insertSimpleHtml(e){var t;this.debugMode&&console.log("Attempting to insert simple HTML:",e);const n=this.editor.data.processor.toView(e),o=this.editor.data.toModel(n,"$root"),i=this.model.document.selection,s=this.model.document.getRoot();let r=i.getLastPosition();const a=o.getChild(o.childCount-1),l=null===(t=i.getLastPosition())||void 0===t?void 0:t.path[0],c=null==s?void 0:s.getChild(null!=l?l:0);this.model.change((e=>{if((null==c?void 0:c.is("element"))&&(r=c.isEmpty?e.createPositionAt(c,"end"):e.createPositionAfter(c)),r&&s){e.setSelection(r),this.model.insertContent(o,r);let t=null==a?void 0:a.getAttribute("listItemId");if((null==a?void 0:a.is("element"))&&(t=t||"table"===a.name),t&&a){const t=e.createElement("paragraph");e.insert(t,e.createPositionAfter(a)),e.setSelection(t,"in")}else a&&e.setSelection(e.createPositionAfter(a))}})),await new Promise((e=>setTimeout(e,100)))}async insertAsText(e,t,n=!1,o=!1){const i=this.editor.data.processor.toView(e.outerHTML),s=this.editor.data.toModel(i,"$root"),r=Array.from(s.getChildren()),a=this.model.document.getRoot();for(const[e,o]of r.entries())if(o.is("element")){const i=0===e?t:void 0;n?await this.insertElementAsStream(o,i):await this.batchInsertOfElement(o,i)}o&&this.model.change((e=>{const t=this.model.document.selection.getLastPosition(),n=null==t?void 0:t.path[0];if(a&&null!=n){const t=e.createElement("paragraph");e.insert(t,a,n+1),e.setSelection(t,"in")}}))}async batchInsertOfElement(e,t){var n;const o=this.model.document.selection,i=this.model.document.getRoot();let s=t;if(!t){const e=null===(n=o.getFirstPosition())||void 0===n?void 0:n.path[0],t=null==i?void 0:i.getChild(null!=e?e:0);(null==t?void 0:t.is("element"))&&(s=t.isEmpty?this.model.createPositionAt(t,"end"):this.model.createPositionAfter(t))}this.model.change((t=>{this.model.insertContent(e,s),t.setSelection(e,"end")}))}async insertElementAsStream(e,t){const n=this.model.document.selection,o=this.model.document.getRoot(),i=n.getLastPosition();let s,r=t;if(t){const e=null==i?void 0:i.parent;(null==e?void 0:e.is("element"))&&(s=e)}else{const t=null==i?void 0:i.path[0],n=null==o?void 0:o.getChild(null!=t?t:0);(null==n?void 0:n.is("element"))&&(r=n.isEmpty?this.model.createPositionAt(n,"end"):this.model.createPositionAfter(n)),this.model.change((t=>{s=t.createElement(e.name);for(const[t,n]of e.getAttributes())s._setAttribute(t,n);this.model.insertContent(s,r),r&&t.setSelection(s,"end")}))}const a=Array.from(e.getChildren()).filter((e=>e.is("$text")));for(const e of a){if(!e.is("$text"))continue;const t=Array.from(e.getAttributes()),n=e._data;for(const e of n)await new Promise((n=>{this.model.change((n=>{const o=this.editor.model.document.selection.getLastPosition(),i=o.getShiftedBy(1).offset===(null==o?void 0:o.parent.maxOffset);n.insertText(e,t,s,i?"end":null==o?void 0:o.offset),n.setSelection(this.editor.model.document.selection.getLastPosition())})),setTimeout(n,5)}))}t||this.model.change((e=>{e.setSelection(s,"end")}))}isCompleteHtmlChunk(e){if((e.match(/<[^/][^>]*>/g)||[]).length!==(e.match(/<\/[^>]+>/g)||[]).length)return!1;if(e.includes("<")&&!e.includes(">"))return!1;const t=e.trim();return!(!t.startsWith("<")||!t.endsWith(">"))}}class W{constructor(e){var t,n,o,i,s,r,a,l,c;this.aiAgentFeatureLockId=Symbol("ai-agent-feature"),this.buffer="",this.openTags=[],this.isInlineInsertion=!1,this.abortGeneration=!1,this.disableFlags=[],this.editor=e,this.promptHelper=new j(e),this.htmlParser=new K(e);const d=e.config.get("aiAgent");this.aiModel=d.model,this.apiKey=d.apiKey,this.endpointUrl=d.endpointUrl,this.temperature=d.temperature,this.timeOutDuration=null!==(t=d.timeOutDuration)&&void 0!==t?t:45e3,this.maxTokens=null!==(n=d.maxOutputTokens)&&void 0!==n?n:d.maxTokens,this.retryAttempts=d.retryAttempts,this.stopSequences=d.stopSequences,this.streamContent=null===(o=d.streamContent)||void 0===o||o,this.moderationKey=null!==(s=null===(i=d.moderation)||void 0===i?void 0:i.key)&&void 0!==s?s:"",this.moderationEnable=null!==(a=null===(r=d.moderation)||void 0===r?void 0:r.enable)&&void 0!==a&&a,this.disableFlags=null!==(c=null===(l=d.moderation)||void 0===l?void 0:l.disableFlags)&&void 0!==c?c:[]}async handleSlashCommand(e){const t=this.editor,n=t.model,o=t.editing.mapper,i=t.editing.view,s=n.document.getRoot();let r,a,l,c;const d=n.document.selection.getLastPosition();if(d&&s){c=d.parent;const e="inline-slash"===c.name?c:void 0,s=o.toViewElement(c);if(l=s?i.domConverter.mapViewToDom(s):void 0,e){t.model.change((t=>{const n=t.createPositionAt(e,"end");t.setSelection(n)})),this.isInlineInsertion=!0;const o=t.model.createPositionAt(e,0),a=t.model.createPositionAt(e,"end"),c=n.createRange(o,a);l=(null==s?void 0:s.parent)?i.domConverter.mapViewToDom(s.parent):void 0,r="";for(const e of c.getItems())e.is("$textProxy")&&(r+=e.data.trim())}else l&&(t.model.change((e=>{const t=e.createPositionAt(d.parent,"end");e.setSelection(t)})),r=null==l?void 0:l.innerText)}if(e){r=e,a=null==l?void 0:l.outerHTML;const t=n.document.selection.getFirstRange();t&&n.change((e=>{e.setSelection(t.end)}))}if(this.moderationEnable){if(!await this.moderateContent(null!=r?r:""))return}try{const e=window.getSelection(),t=(null==e?void 0:e.getRangeAt(0)).getBoundingClientRect();f.showLoader(t);const n=await this.generateGptPromptBasedOnUserPrompt(null!=r?r:"",null==l?void 0:l.innerText,a);c&&n&&await this.fetchAndProcessGptResponse(n,c)}catch(e){throw console.error("Error handling slash command:",e),e}finally{this.isInlineInsertion=!1,f.hideLoader()}}async moderateContent(e){var t;if(!this.moderationKey)return!0;const n=this.editor.t,o=new AbortController,i=setTimeout((()=>o.abort()),this.timeOutDuration);try{const s=await fetch("https://api.openai.com/v1/moderations",{method:"POST",headers:{Authorization:`Bearer ${this.moderationKey}`,"Content-Type":"application/json"},body:JSON.stringify({input:e}),signal:o.signal});if(clearTimeout(i),!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const r=await s.json();if(!(null===(t=null==r?void 0:r.results)||void 0===t?void 0:t[0]))throw new Error("Invalid moderation response format");const a=E.filter((e=>!this.disableFlags.includes(e)));if(r.results[0].flagged){let e=!1;const t=r.results[0].categories;for(let n=0;n<a.length;n++){const o=a[n];if(a.includes(o)&&t[o]){e=!0;break}}if(e)return f.showError(n("I'm sorry, but I cannot assist with that request.")),!1}return!0}catch(e){return console.error("Moderation error:",e),e instanceof TypeError?f.showError(n("Network error during content moderation")):e instanceof DOMException&&"AbortError"===e.name?f.showError(n("Content moderation timed out")):f.showError(n("Error in content moderation")),!0}finally{clearTimeout(i)}}async fetchAndProcessGptResponse(e,t,n=this.retryAttempts){var o,i,s;console.log("Starting fetchAndProcessGptResponse");const r=this.editor,a=r.t,l=new AbortController,c=setTimeout((()=>l.abort()),this.timeOutDuration);let d="",h="";const u=`ai-${(new Date).getTime()}`;try{const n=await fetch(this.endpointUrl,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:this.aiModel,messages:[{role:"system",content:this.promptHelper.getSystemPrompt(this.isInlineInsertion)},{role:"user",content:e}],temperature:this.temperature,max_tokens:this.maxTokens,stop:this.stopSequences,stream:!0}),signal:l.signal});if(clearTimeout(c),!n.ok)throw new Error("Fetch failed");f.hideLoader();const s=n.body.getReader(),a=new TextDecoder("utf-8");this.clearParentContent(t);let m=!0;for(this.cancelGenerationButton(u,l),r.model.change((e=>{var t;const n=r.model.document.selection.getLastPosition();if(n){const o=e.createElement("ai-tag",{id:u}),i=n.parent;i&&("tableCell"===(null===(t=i.parent)||void 0===t?void 0:t.name)||"bulleted"===i.getAttribute("listType"))&&(m=!1);let s="";for(const e of i.getChildren())e.is("$text")&&(s+=e.data);const r=s?e.createPositionAt(n.parent,"after"):e.createPositionAt(n.parent,"before");e.insert(o,m?r:n);const a=e.createPositionAt(o,"end");e.setSelection(a)}})),console.log("Starting to process response");;){const{done:e,value:t}=await s.read();if(e){console.log("Finished reading response");break}let n;for(d+=a.decode(t,{stream:!0});-1!==(n=d.indexOf("\n"));){const e=d.slice(0,n).trim();if(d=d.slice(n+1),e.startsWith("data: ")){const t=e.slice(5).trim();if("[DONE]"===t){console.log("Received [DONE] signal");break}try{const e=null===(i=null===(o=JSON.parse(t).choices[0])||void 0===o?void 0:o.delta)||void 0===i?void 0:i.content;null!=e&&(h+=e),await this.updateContent(h,u)}catch(e){console.warn("Error parsing JSON:",e)}}}}this.processCompleted(u)}catch(o){if(this.abortGeneration)return;console.error("Error in fetchAndProcessGptResponse:",o);const i=((null==o?void 0:o.message)||"").trim()||((null==o?void 0:o.name)||"").trim(),r=["AbortError","ReadableStream not supported","AiAgent: Fetch failed"].includes(i);if(n>0&&r)return console.warn(`Retrying... (${n} attempts left)`),await this.fetchAndProcessGptResponse(e,t,n-1);let l;if("ReadableStream not supported"===((null==o?void 0:o.name)||(null===(s=null==o?void 0:o.message)||void 0===s?void 0:s.trim())))l=a("Browser does not support readable streams");else l=a("We couldn't connect to the AI. Please check your internet");f.showError(l)}finally{this.editor.disableReadOnlyMode(this.aiAgentFeatureLockId)}}cancelGenerationButton(e,t){const o=this.editor,i=o.t,s=new n;let r=i("Cancel Generation");if(p.isMac&&(r=i("⌘ + ⌫ Cancel Generation")),p.isWindows&&(r=i("Ctrl + ⌫ Cancel Generation")),s.set({label:r,withText:!0,class:"ck-cancel-request-button"}),s.on("execute",(()=>{this.abortGeneration=!0,t.abort(),this.processCompleted(e)})),s.render(),o.keystrokes.set("Ctrl+Backspace",((n,o)=>{(n.ctrlKey||n.metaKey)&&(this.abortGeneration=!0,t.abort(),this.processCompleted(e)),o()})),o.ui.view.element&&s.element){const e=o.ui.view.element.querySelector(".ck-sticky-panel__content .ck-toolbar__items");e&&e.append(s.element)}setTimeout((()=>s.set({class:"ck-cancel-request-button visible"})),2e3)}processCompleted(e){const t=this.editor;if(t.ui.view.element){const e=t.ui.view.element.querySelector(".ck-cancel-request-button");e&&e.remove()}let n=t.getData().replace(/<\/ai-tag>\s*<[^>]+>\s*&nbsp;\s*<\/[^>]+>/g,"");n=n.replace(`<ai-tag id="${e}">`,""),t.setData(n)}getViewChildrens(e,t){const n=[];for(const o of e.getChildren())if(o.is("element"))if(o.is("element","ai-tag")&&o.getAttribute("id")===t)n.push(o);else{const e=this.getViewChildrens(o,t);n.push(...e)}return n}async updateContent(e,t){const n=this.editor;n.model.change((o=>{const i=n.model.document.getRoot();if(i){const s=this.getViewChildrens(i,t),r=s.length?s[0]:null;if(r){const t=n.model.createRangeIn(r);o.remove(t);const i=n.data.processor.toView(e),s=n.data.toModel(i);o.insert(s,r,"end")}}})),await new Promise((e=>setTimeout(e)))}async processContent(e){try{if(console.log("--- Start of processContent ---"),console.log("Processing content:",e,this.isInlineInsertion),this.isInlineInsertion){const t=this.editor.model.document.selection.getLastPosition(),n=document.createElement("div");n.innerHTML=e,await this.htmlParser.insertAsText(n||"",null!=t?t:void 0,this.streamContent)}else this.streamContent?await this.proceedHtmlResponse(e):await this.htmlParser.insertSimpleHtml(e);console.log("--- End of processContent ---")}catch(e){console.error(e)}}async proceedHtmlResponse(e){const t=document.createElement("div");t.innerHTML=e;for(const e of Array.from(t.childNodes)){const t=e;if(t.nodeType===Node.ELEMENT_NODE){const e=t.tagName.toLowerCase();["table","blockquote","pre","img","form","figure"].includes(e)?await this.htmlParser.insertSimpleHtml(t.outerHTML):"ul"===e||"ol"===e?await this.htmlParser.insertAsText(t,void 0,!0,!0):await this.htmlParser.insertAsText(t,void 0,!0)}else if(t.nodeType===Node.TEXT_NODE&&t.textContent){const e=document.createElement("div");e.innerText=t.textContent,await this.htmlParser.insertAsText(e,void 0,!0)}}}clearParentContent(e){const t=this.editor,n=t.model,o=n.document.getRoot(),i=n.document.selection.getLastPosition(),s=Array.from(e.getChildren()).find((e=>"inline-slash"===e.name));o&&i&&t.model.change((t=>{const r=(null==s?void 0:s.getPath())||e.getPath(),a=n.createRange(n.createPositionFromPath(o,r),n.createPositionFromPath(o,i.path));t.remove(a)}))}async generateGptPromptBasedOnUserPrompt(e,t,n){try{const o=this.promptHelper.trimContext(e,t),i=n?e:e.slice(1);let s=[];const r=/https?:\/\/[^\s/$.?#].[^\s]*/g,a=e.match(r);if(Array.isArray(a)&&a.length){const t=a.map((e=>e.replace(/[,.]$/,"")));s=await this.promptHelper.generateMarkDownForUrls(t),s=this.promptHelper.allocateTokensToFetchedContent(e,s)}const l="@@@cursor@@@"===o;return this.promptHelper.formatFinalPrompt(i,o,n,s,l)}catch(e){return console.error(e),null}}}class X extends e{constructor(e){var t,n;super(e),this.PLACEHOLDER_TEXT_ID="slash-placeholder",this.GPT_RESPONSE_LOADER_ID="gpt-response-loader",this.GPT_RESPONSE_ERROR_ID="gpt-error",this.showErrorDuration=5e3,this.commandsDropdown=T;const o=e.config.get("aiAgent");this.showErrorDuration=null!==(t=null==o?void 0:o.showErrorDuration)&&void 0!==t?t:5e3,this.commandsDropdown=null!==(n=null==o?void 0:o.commandsDropdown)&&void 0!==n?n:T}static get pluginName(){return"AiAgentUI"}static get requires(){return[u]}init(){try{f.uiComponent=this,this.initializeUIComponents(),this.initializeUILanguage(),this.attachListener()}catch(e){console.error(e.message)}}initializeUIComponents(){const e=this.editor,t=e.t;e.model.schema.register("inline-slash",{inheritAllFrom:"$block",isInline:!0,isObject:!0,allowWhere:"$text",allowAttributes:["class"]}),e.model.schema.extend("$text",{allowIn:"inline-slash"}),e.conversion.for("upcast").elementToElement({view:{name:"inline-slash",attributes:["class"]},model:(e,{writer:t})=>t.createElement("inline-slash",{class:e.getAttribute("class")}),converterPriority:"high"}),e.conversion.for("downcast").elementToElement({model:{name:"inline-slash",attributes:["class"]},view:(e,{writer:t})=>t.createContainerElement("inline-slash",{class:e.getAttribute("class")})}),this.addPlaceholder(),this.addLoader(),this.addGptErrorToolTip(),this.addAiAgentButton(),e.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Insert slash command (AI Agent)"),keystroke:"/"}]}),e.model.schema.register("ai-tag",{inheritAllFrom:"$block",isInline:!0,isObject:!0,allowWhere:"$block",allowAttributes:["id"]}),e.model.schema.extend("$block",{allowIn:"ai-tag"}),this.addCustomTagConversions();let n="";p.isMac&&(n="Cmd + Backspace"),p.isWindows&&(n="Ctrl + Backspace"),e.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Cancel AI Generation"),keystroke:n}]})}addCustomTagConversions(){const e=this.editor;e.conversion.for("upcast").elementToElement({view:{name:"ai-tag",attributes:["id"]},model:(e,{writer:t})=>t.createElement("ai-tag",{id:e.getAttribute("id")})}),e.conversion.for("dataDowncast").elementToElement({model:"ai-tag",view:(e,{writer:t})=>t.createContainerElement("ai-tag",{id:e.getAttribute("id")})}),e.conversion.for("editingDowncast").elementToElement({model:"ai-tag",view:(e,{writer:t})=>{const n=t.createContainerElement("ai-tag",{id:e.getAttribute("id")});return m(n,t)}})}addAiAgentButton(){const e=this.editor.t,t=this.editor.model,n=this.editor.editing.view.document;this.editor.ui.componentFactory.add("aiAgentButton",(u=>{const m=o(u,i);m.class="ck-ai-commands-list";const p=m.buttonView;p.set({label:e("AI Agent"),icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4.00815 5.01816H19.3851V10.9145H21.1594V3.2439H2.23389V22.1694H12.3955V20.3951H4.00815V5.01816Z" fill="#222330"/>\n    <path d="M15.1908 20.046L20.9028 12.7065L22.9998 14.3385L17.2878 21.678L15.0341 22.755C14.8582 22.8391 14.6619 22.6862 14.7002 22.4951L15.1908 20.046Z" fill="#222330"/>\n    <path d="M16.1211 8.43794V15.7494H14.5753V8.43794H16.1211Z" fill="#222330"/>\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M8.31458 15.7495H6.65807L9.18211 8.43804H11.1742L13.6947 15.7495H12.0382L11.4968 14.0823H8.85696L8.31458 15.7495ZM10.2067 10.1088L11.1051 12.8756H9.24951L10.1496 10.1088H10.2067Z" fill="#222330"/>\n</svg>',tooltip:!0}),p.on("execute",(()=>{this.editor.model.change((e=>{const t=this.editor.model.document.selection.getLastPosition();if(t){const n=e.createElement("inline-slash",{class:"ck-slash"});e.insertText("/",n),e.insert(n,t);const o=e.createPositionAt(n,"end");e.setSelection(o)}})),this.editor.editing.view.focus()}));const g=new s(u),f=new r(u),v=new a(u,g),w=new l(u,c);w.label=e("Search AI command");const E=document.createElement("div");E.className="ck-input-icon-wrapper";const T=document.createElement("span");T.className="ck-input-search-icon",T.innerHTML='<svg class="svg-icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M679.039688 749.379825a29.25665 29.25665 0 0 1 46.225506-35.927166l204.796548 263.309847a29.25665 29.25665 0 0 1-46.225507 35.927166l-204.796547-263.309847zM482.727568 789.929541C264.589988 789.929541 87.762798 613.102351 87.762798 394.964771S264.589988 0 482.727568 0 877.692339 176.827191 877.692339 394.964771 700.865148 789.929541 482.727568 789.929541z m0-58.513299C668.53655 731.416242 819.17904 580.773753 819.17904 394.964771S668.53655 58.513299 482.727568 58.513299 146.276097 209.155789 146.276097 394.964771 296.918586 731.416242 482.727568 731.416242z" fill="#7F7F7F" /></svg>',E.appendChild(T),w.fieldView.on("input",(()=>{var e;if(null===(e=null==w?void 0:w.fieldView)||void 0===e?void 0:e.element){const e=w.fieldView.element.value.toLowerCase();this.aiAgentListItemUpdate(f,"search",e)}})),n.on("selectionChange",(()=>{const e=t.document.selection.getFirstRange();if(e){const t=!!Array.from(e.getItems()).map((e=>e.data)).join("");this.aiAgentListItemUpdate(f,"enable",t)}})),v.children.add(w),f.items.add(v),w.element&&w.element.appendChild(E);for(const t of this.commandsDropdown){const n=new d(u);f.items.add(n);const o=new a(u,g),i=new h(u);i.set({label:e(t.title),class:"ck-menu-group-title",isEnabled:!1}),o.children.add(i),f.items.add(o);for(const n of t.items){const t=new a(u,g),o=new h(u);o.set({label:e(n.title),class:"ck-menu-item",isEnabled:!1}),o.delegate("execute").to(g),o.on("execute",(()=>{const e=new W(this.editor);this.editor.editing.view.focus(),e.handleSlashCommand(n.command)})),t.children.add(o),f.items.add(t)}}return m.panelView.children.add(f),m}))}aiAgentListItemUpdate(e,t,n){e.items.map((e=>{var o;const i=e;if(null===(o=i.children)||void 0===o?void 0:o.first){const e=i.children.first;if(e.class){const o=e.class.includes("ck-menu-group-title"),s=e.class.includes("ck-ai-search-input"),r=!e.label;if(!o&&!r&&!s){const o=e.label.toLowerCase();"search"===t&&(i.isVisible=!n||o.includes(n)),"enable"===t&&(i.isEnabled=n,e.isEnabled=n)}}}}))}initializeUILanguage(){const e=this.editor,t=e.t,n=e.locale.contentLanguage;w.includes(n)||this.showGptErrorToolTip(t("Unsupported language code"))}attachListener(){const e=this.editor,t=e.model;t.document.on("change:data",(()=>{setTimeout((()=>{this.applyPlaceholderToCurrentLine()}),10)})),t.document.selection.on("change:range",(()=>{setTimeout((()=>{this.applyPlaceholderToCurrentLine()}),10);const t=e.model.document.getRoot();if(t){const n=e.model.createRangeIn(t),o=[];for(const e of n.getItems())e.is("element","inline-slash")&&e.isEmpty&&o.push(e);e.model.change((e=>{for(const t of o)e.remove(t)}))}})),e.editing.view.document.on("scroll",(()=>{this.hidePlaceHolder()})),document.addEventListener("scroll",(()=>{this.hidePlaceHolder()}))}applyPlaceholderToCurrentLine(){var e;const t=null===(e=this.editor.model.document.selection.getFirstPosition())||void 0===e?void 0:e.parent;t&&t.isEmpty?(this.hidePlaceHolder(),setTimeout((async()=>{if(t.is("element")){const e=await this.getRectDomOfGivenModelElement(t);e&&this.showPlaceHolder(e)}}),100)):this.hidePlaceHolder()}async getRectDomOfGivenModelElement(e){const t=this.editor,n=t.editing.mapper,o=t.editing.view,i=n.toViewElement(e);if(i){const e=o.domConverter.mapViewToDom(i);if(e)return e.getBoundingClientRect()}return null}addPlaceholder(){const e=this.editor,t=e.t,n=document.createElement("p");n.id=this.PLACEHOLDER_TEXT_ID,n.onclick=()=>{e.focus()},n.classList.add("place-holder"),n.textContent=t("Type / to request AI content"),setTimeout((async()=>{const t=e.ui.view.element;t&&t.append(n)}))}showPlaceHolder(e){var t;const n=null===(t=this.editor.ui.view.element)||void 0===t?void 0:t.querySelector(`#${this.PLACEHOLDER_TEXT_ID}`),o=this.editor.isReadOnly;n&&e&&!o?(n.classList.add("show-place-holder"),n.style.left=`${e.left}px`,n.style.top=`${e.top}px`):n&&n.classList.remove("show-place-holder")}hidePlaceHolder(){var e;const t=null===(e=this.editor.ui.view.element)||void 0===e?void 0:e.querySelector(`#${this.PLACEHOLDER_TEXT_ID}`);t&&t.classList.remove("show-place-holder")}addLoader(){const e=document.createElement("div");e.id=this.GPT_RESPONSE_LOADER_ID,e.classList.add("gpt-loader"),document.body.appendChild(e)}showLoader(e){const t=document.getElementById(this.GPT_RESPONSE_LOADER_ID);t&&e?(t.style.left=`${e.left+10}px`,t.style.top=`${e.top+10}px`,t.classList.add("show-gpt-loader")):t&&t.classList.remove("show-gpt-loader")}hideLoader(){const e=document.getElementById(this.GPT_RESPONSE_LOADER_ID);e&&e.classList.remove("show-gpt-loader")}addGptErrorToolTip(){const e=document.createElement("p");e.id=this.GPT_RESPONSE_ERROR_ID,e.classList.add("response-error"),document.body.appendChild(e)}showGptErrorToolTip(e){var t,n,o;console.log("Showing error message...",e);const i=this.editor,s=null===(o=null===(n=null===(t=null==i?void 0:i.editing)||void 0===t?void 0:t.view)||void 0===n?void 0:n.domRoots)||void 0===o?void 0:o.get("main"),r=document.getElementById(this.GPT_RESPONSE_ERROR_ID),a=null==s?void 0:s.getBoundingClientRect();r&&a&&(r.classList.add("show-response-error"),r.textContent=e,setTimeout((()=>{this.hideGptErrorToolTip()}),this.showErrorDuration))}hideGptErrorToolTip(){const e=document.getElementById(this.GPT_RESPONSE_ERROR_ID);e&&e.classList.remove("show-response-error")}}class Z extends t{constructor(e,t){super(e),this.aiAgentService=t}refresh(){this.isEnabled=!0}async execute(){await this.aiAgentService.handleSlashCommand()}}class J extends e{static get pluginName(){return"AiAgentEditing"}init(){const e=this.editor,t=new W(e);e.commands.add("aiAgent",new Z(e,t)),this.setupEnterKeyHandling()}setupEnterKeyHandling(){const e=this.editor,t=e.model,n=e.editing.mapper,o=e.editing.view;e.keystrokes.set("enter",(async(i,s)=>{var r;const a=t.document.selection.getFirstPosition();if(a){const t=a.parent,i=Array.from(t.getChildren()).find((e=>"inline-slash"===e.name)),l=n.toViewElement(t);let c;l&&(c=null===(r=o.domConverter.mapViewToDom(l))||void 0===r?void 0:r.innerText),("string"==typeof c&&c.startsWith("/")||i)&&(s(),await e.execute("aiAgent"))}}))}}class Y extends e{constructor(e){super(e),this.DEFAULT_GPT_MODEL="gpt-4o",this.DEFAULT_AI_END_POINT="https://api.openai.com/v1/chat/completions";const t=e.config.get("aiAgent")||{},n={...{model:this.DEFAULT_GPT_MODEL,apiKey:"",endpointUrl:this.DEFAULT_AI_END_POINT,temperature:.7,timeOutDuration:45e3,maxOutputTokens:v[this.DEFAULT_GPT_MODEL].maxOutputTokens,maxInputTokens:v[this.DEFAULT_GPT_MODEL].maxInputContextTokens,retryAttempts:1,contextSize:.75*v[this.DEFAULT_GPT_MODEL].maxInputContextTokens,stopSequences:[],promptSettings:{},debugMode:!1,streamContent:!0},...t};e.config.set("aiAgent",n),this.validateConfiguration(n)}static get requires(){return[X,J]}static get pluginName(){return"AiAgent"}validateConfiguration(e){if(!e.apiKey)throw new Error("AiAgent: apiKey is required.");if(e.temperature&&(e.temperature<0||e.temperature>2))throw new Error("AiAgent: Temperature must be a number between 0 and 2.");const t=v[e.model];if(void 0!==e.maxOutputTokens&&(e.maxOutputTokens<t.minOutputTokens||e.maxOutputTokens>t.maxOutputTokens))throw new Error(`AiAgent: maxOutputTokens must be between ${t.minOutputTokens} and ${t.maxOutputTokens} for ${e.model}`);if(void 0!==e.maxInputTokens&&e.maxInputTokens>t.maxInputContextTokens)throw new Error(`AiAgent: maxInputTokens cannot exceed ${t.maxInputContextTokens} for ${e.model}`)}init(){}}const Q={ckeditor:"<svg width='68' height='64' viewBox='0 0 68 64' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M43.71 11.025a11.508 11.508 0 0 0-1.213 5.159c0 6.42 5.244 11.625 11.713 11.625.083 0 .167 0 .25-.002v16.282a5.464 5.464 0 0 1-2.756 4.739L30.986 60.7a5.548 5.548 0 0 1-5.512 0L4.756 48.828A5.464 5.464 0 0 1 2 44.089V20.344c0-1.955 1.05-3.76 2.756-4.738L25.474 3.733a5.548 5.548 0 0 1 5.512 0l12.724 7.292z' fill='#FFF'/><path d='M45.684 8.79a12.604 12.604 0 0 0-1.329 5.65c0 7.032 5.744 12.733 12.829 12.733.091 0 .183-.001.274-.003v17.834a5.987 5.987 0 0 1-3.019 5.19L31.747 63.196a6.076 6.076 0 0 1-6.037 0L3.02 50.193A5.984 5.984 0 0 1 0 45.003V18.997c0-2.14 1.15-4.119 3.019-5.19L25.71.804a6.076 6.076 0 0 1 6.037 0L45.684 8.79zm-29.44 11.89c-.834 0-1.51.671-1.51 1.498v.715c0 .828.676 1.498 1.51 1.498h25.489c.833 0 1.51-.67 1.51-1.498v-.715c0-.827-.677-1.498-1.51-1.498h-25.49.001zm0 9.227c-.834 0-1.51.671-1.51 1.498v.715c0 .828.676 1.498 1.51 1.498h18.479c.833 0 1.509-.67 1.509-1.498v-.715c0-.827-.676-1.498-1.51-1.498H16.244zm0 9.227c-.834 0-1.51.671-1.51 1.498v.715c0 .828.676 1.498 1.51 1.498h25.489c.833 0 1.51-.67 1.51-1.498v-.715c0-.827-.677-1.498-1.51-1.498h-25.49.001zm41.191-14.459c-5.835 0-10.565-4.695-10.565-10.486 0-5.792 4.73-10.487 10.565-10.487C63.27 3.703 68 8.398 68 14.19c0 5.791-4.73 10.486-10.565 10.486v-.001z' fill='#1EBC61' fill-rule='nonzero'/><path d='M60.857 15.995c0-.467-.084-.875-.251-1.225a2.547 2.547 0 0 0-.686-.88 2.888 2.888 0 0 0-1.026-.531 4.418 4.418 0 0 0-1.259-.175c-.134 0-.283.006-.447.018-.15.01-.3.034-.446.07l.075-1.4h3.587v-1.8h-5.462l-.214 5.06c.319-.116.682-.21 1.089-.28.406-.071.77-.107 1.088-.107.218 0 .437.021.655.063.218.041.413.114.585.218s.313.244.422.419c.109.175.163.391.163.65 0 .424-.132.745-.396.961a1.434 1.434 0 0 1-.938.325c-.352 0-.656-.1-.912-.3-.256-.2-.43-.453-.523-.762l-1.925.588c.1.35.258.664.472.943.214.279.47.514.767.706.298.191.63.339.995.443.365.104.749.156 1.151.156.437 0 .86-.064 1.272-.193.41-.13.778-.323 1.1-.581a2.8 2.8 0 0 0 .775-.981c.193-.396.29-.864.29-1.405h-.001z' fill='#FFF' fill-rule='nonzero'/></g></svg>\n"};export{Y as AiAgent,Q as icons};
//# sourceMappingURL=index.js.map
