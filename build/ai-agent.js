!function(t){const e=t.en=t.en||{};e.dictionary=Object.assign(e.dictionary||{},{"Ai agent":"Ai agent","Browser does not support readable streams":"Browser does not support readable streams","Type / to request AI content":"Type / to request AI content","Unsupported language code":"Unsupported language code","We couldn't connect to the AI. Please check your internet":"We couldn't connect to the AI. Please check your internet"})}(window.CKEDITOR_TRANSLATIONS||(window.CKEDITOR_TRANSLATIONS={})),(()=>{var t={346:(t,e,n)=>{"use strict";n.d(e,{A:()=>r});var o=n(314),i=n.n(o)()((function(t){return t[1]}));i.push([t.id,'.place-holder{color:grey;margin:0;opacity:0;position:fixed;transition-duration:.2s;transition-property:opacity;transition-timing-function:ease-in,ease-out;z-index:100}.show-place-holder{opacity:1;transition-duration:1s}.gpt-loader{animation:l2 1.5s linear infinite;aspect-ratio:1;background:#000;border-radius:50%;box-shadow:0 0 0 0 rgba(0,4,15,.377);height:5px;opacity:0;position:fixed;width:5px}.show-gpt-loader{opacity:1}.gpt-loader:after,.gpt-loader:before{animation:inherit;animation-delay:-.5s;border-radius:inherit;box-shadow:0 0 0 0 rgba(0,4,15,.377);content:"";inset:0;position:absolute}.gpt-loader:after{animation-delay:-1s}@keyframes l2{to{box-shadow:0 0 0 40px rgba(0,4,15,0)}}.response-error{background:#c17171;border-radius:5px;color:#fff;opacity:0;padding:5px 10px;position:fixed;right:10px;top:0;transition-duration:1s;transition-property:opacity;width:auto;z-index:100}.show-response-error{opacity:1}.ck-slash{animation:ck-fade-in-pulse .75s ease-out forwards;background:#fbfbc1;display:inline-block;font-size:18px;opacity:0;padding:0 5px;text-shadow:0 0 10px var(--ck-color-widget-hover-border),0 0 20px var(--ck-color-widget-hover-border),0 0 30px var(--ck-color-widget-hover-border),0 0 40px var(--ck-color-widget-hover-border)}@keyframes ck-fade-in-pulse{0%{color:#fff;opacity:0;transform:scale(1)}50%{color:#fff;opacity:1;text-shadow:0 0 10px var(--ck-color-widget-hover-border),0 0 20px var(--ck-color-widget-hover-border),0 0 30px var(--ck-color-widget-hover-border),0 0 40px var(--ck-color-widget-hover-border);transform:scale(1.1)}to{color:inherit;opacity:1;text-shadow:none;transform:scale(1)}}@media (prefers-reduced-motion:reduce){.ck-slash{animation:none;opacity:1;text-shadow:none}}',""]);const r=i},314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=t(e);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,o){"string"==typeof t&&(t=[[null,t,""]]);var i={};if(o)for(var r=0;r<this.length;r++){var s=this[r][0];null!=s&&(i[s]=!0)}for(var a=0;a<t.length;a++){var l=[].concat(t[a]);o&&i[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),e.push(l))}},e}},361:(t,e)=>{var n,o=["al","adj","assn","Ave","BSc","MSc","Cell","Ch","Co","cc","Corp","Dem","Dept","ed","eg","Eq","Eqs","est","est","etc","Ex","ext","Fig","fig","Figs","figs","i.e","ie","Inc","inc","Jan","Feb","Mar","Apr","Jun","Jul","Aug","Sep","Sept","Oct","Nov","Dec","jr","mi","Miss","Mrs","Mr","Ms","Mol","mt","mts","no","Nos","PhD","MD","BA","MA","MM","pl","pop","pp","Prof","Dr","pt","Ref","Refs","Rep","repr","rev","Sec","Secs","Sgt","Col","Gen","Rep","Sen","Gov","Lt","Maj","Capt","St","Sr","sr","Jr","jr","Rev","Sun","Mon","Tu","Tue","Tues","Wed","Th","Thu","Thur","Thurs","Fri","Sat","trans","Univ","Viz","Vol","vs","v"];e.setAbbreviations=function(t){n=t||o};var i=e.isCapitalized=function(t){return/^[A-Z][a-z].*/.test(t)||r(t)};e.isSentenceStarter=function(t){return i(t)||/``|"|'/.test(t.substring(0,2))},e.isCommonAbbreviation=function(t){var e=t.replace(/[-'`~!@#$%^&*()_|+=?;:'",.<>\{\}\[\]\\\/]/gi,"");return~n.indexOf(e)},e.isTimeAbbreviation=function(t,e){if(("a.m."===t||"p.m."===t)&&"day"===e.replace(/\W+/g,"").slice(-3).toLowerCase())return!0;return!1},e.isDottedAbbreviation=function(t){var e=t.replace(/[\(\)\[\]\{\}]/g,"").match(/(.\.)*/);return e&&e[0].length>0},e.isCustomAbbreviation=function(t){return t.length<=3||i(t)},e.isNameAbbreviation=function(t,e){return e.length>0&&(!!(t<5&&e[0].length<6&&i(e[0]))||e.filter((function(t){return/[A-Z]/.test(t.charAt(0))})).length>=3)};var r=e.isNumber=function(t,e){return e&&(t=t.slice(e-1,e+2)),!isNaN(t)};e.isPhoneNr=function(t){return t.match(/^(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?$/)},e.isURL=function(t){return t.match(/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/)},e.isConcatenated=function(t){var e=0;if(((e=t.indexOf("."))>-1||(e=t.indexOf("!"))>-1||(e=t.indexOf("?"))>-1)&&t.charAt(e+1).match(/[a-zA-Z].*/))return[t.slice(0,e),t.slice(e+1)];return!1},e.isBoundaryChar=function(t){return"."===t||"!"===t||"?"===t}},814:t=>{t.exports=function(t,e){if(("string"==typeof t||t instanceof String)&&"undefined"!=typeof document){var n=document.createElement("DIV");n.innerHTML=t,t=(n.textContent||"").trim()}else"object"==typeof t&&t.textContent&&(t=(t.textContent||"").trim());return t}},23:(t,e)=>{e.endsWithChar=function(t,e){return e.length>1?e.indexOf(t.slice(-1))>-1:t.slice(-1)===e},e.endsWith=function(t,e){return t.slice(t.length-e.length)===e}},541:(t,e,n)=>{var o=n(814),i=n(23),r=n(361),s=" @~@ ",a=s.trim(),l=new RegExp("\\S",""),c=new RegExp("\\n+|[-#=_+*]{4,}","g"),d=new RegExp("\\S+|\\n","g");e.sentences=function(t,e){if(!t||"string"!=typeof t||!t.length)return[];if(!l.test(t))return[];var n,u,h={newline_boundaries:!1,html_boundaries:!1,html_boundaries_tags:["p","div","ul","ol"],sanitize:!1,allowed_tags:!1,preserve_whitespace:!1,abbreviations:null};if("boolean"==typeof e)h.newline_boundaries=!0;else for(var p in e)h[p]=e[p];if(r.setAbbreviations(h.abbreviations),h.newline_boundaries&&(t=t.replace(c,s)),h.html_boundaries){var m="(<br\\s*\\/?>|<\\/("+h.html_boundaries_tags.join("|")+")>)",g=new RegExp(m,"g");t=t.replace(g,"$1"+s)}(h.sanitize||h.allowed_tags)&&(h.allowed_tags||(h.allowed_tags=[""]),t=o(t,{allowedTags:h.allowed_tags}));var f=0,v=0,w=[],b=[],y=[];if(!(n=h.preserve_whitespace?(u=t.split(/(<br\s*\/?>|\S+|\n+)/)).filter((function(t,e){return e%2})):t.trim().match(d))||!n.length)return[];for(var x=0,T=n.length;x<T;x++)if(f++,y.push(n[x]),~n[x].indexOf(",")&&(f=0),r.isBoundaryChar(n[x])||i.endsWithChar(n[x],"?!")||n[x]===a)(h.newline_boundaries||h.html_boundaries)&&n[x]===a&&y.pop(),b.push(y),f=0,y=[];else if((i.endsWithChar(n[x],'"')||i.endsWithChar(n[x],"â€"))&&(n[x]=n[x].slice(0,-1)),i.endsWithChar(n[x],".")){if(x+1<T){if(2===n[x].length&&isNaN(n[x].charAt(0)))continue;if(r.isCommonAbbreviation(n[x]))continue;if(r.isSentenceStarter(n[x+1])){if(r.isTimeAbbreviation(n[x],n[x+1]))continue;if(r.isNameAbbreviation(f,n.slice(x,6)))continue;if(r.isNumber(n[x+1])&&r.isCustomAbbreviation(n[x]))continue}else{if(i.endsWith(n[x],".."))continue;if(r.isDottedAbbreviation(n[x]))continue;if(r.isNameAbbreviation(f,n.slice(x,5)))continue}}b.push(y),y=[],f=0}else{if((v=n[x].indexOf("."))>-1){if(r.isNumber(n[x],v))continue;if(r.isDottedAbbreviation(n[x]))continue;if(r.isURL(n[x])||r.isPhoneNr(n[x]))continue}(w=r.isConcatenated(n[x]))&&(y.pop(),y.push(w[0]),b.push(y),f=0,(y=[]).push(w[1]))}return y.length&&b.push(y),(b=b.filter((function(t){return t.length>0}))).slice(1).reduce((function(t,e){var n=t[t.length-1];return 1===n.length&&/^.{1,2}[.]$/.test(n[0])&&!/[.]/.test(e[0])?(t.pop(),t.push(n.concat(e)),t):(t.push(e),t)}),[b[0]]).map((function(t,e){if(h.preserve_whitespace&&!h.newline_boundaries&&!h.html_boundaries){var n=2*t.length;return 0===e&&(n+=1),u.splice(0,n).join("")}return t.join(" ")}))}},72:(t,e,n)=>{"use strict";var o,i=function(){return void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o},r=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),s=[];function a(t){for(var e=-1,n=0;n<s.length;n++)if(s[n].identifier===t){e=n;break}return e}function l(t,e){for(var n={},o=[],i=0;i<t.length;i++){var r=t[i],l=e.base?r[0]+e.base:r[0],c=n[l]||0,d="".concat(l," ").concat(c);n[l]=c+1;var u=a(d),h={css:r[1],media:r[2],sourceMap:r[3]};-1!==u?(s[u].references++,s[u].updater(h)):s.push({identifier:d,updater:f(h,e),references:1}),o.push(d)}return o}function c(t){var e=document.createElement("style"),o=t.attributes||{};if(void 0===o.nonce){var i=n.nc;i&&(o.nonce=i)}if(Object.keys(o).forEach((function(t){e.setAttribute(t,o[t])})),"function"==typeof t.insert)t.insert(e);else{var s=r(t.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(e)}return e}var d,u=(d=[],function(t,e){return d[t]=e,d.filter(Boolean).join("\n")});function h(t,e,n,o){var i=n?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(t.styleSheet)t.styleSheet.cssText=u(e,i);else{var r=document.createTextNode(i),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(r,s[e]):t.appendChild(r)}}function p(t,e,n){var o=n.css,i=n.media,r=n.sourceMap;if(i?t.setAttribute("media",i):t.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleSheet)t.styleSheet.cssText=o;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(o))}}var m=null,g=0;function f(t,e){var n,o,i;if(e.singleton){var r=g++;n=m||(m=c(e)),o=h.bind(null,n,r,!1),i=h.bind(null,n,r,!0)}else n=c(e),o=p.bind(null,n,e),i=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return o(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;o(t=e)}else i()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=i());var n=l(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var o=0;o<n.length;o++){var i=a(n[o]);s[i].references--}for(var r=l(t,e),c=0;c<n.length;c++){var d=a(n[c]);0===s[d].references&&(s[d].updater(),s.splice(d,1))}n=r}}}},782:(t,e,n)=>{t.exports=n(237)("./src/core.js")},311:(t,e,n)=>{t.exports=n(237)("./src/ui.js")},901:(t,e,n)=>{t.exports=n(237)("./src/widget.js")},237:t=>{"use strict";t.exports=CKEditor5.dll}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={id:o,exports:{}};return t[o](r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.nc=void 0;var o={};(()=>{"use strict";n.r(o),n.d(o,{AiAgent:()=>k,icons:()=>L});var t=n(782),e=n(311);class i{constructor(){}static getInstance(){return i.instance||(i.instance=new i),i.instance}set uiComponent(t){this._uiComponent=t}showError(t){this._uiComponent&&(console.log("Showing error message...",t),this._uiComponent.showGptErrorToolTip(t))}showLoader(t){this._uiComponent&&this._uiComponent.showLoader(t)}hideLoader(){this._uiComponent&&this._uiComponent.hideLoader()}}const r=i.getInstance(),s={"gpt-3.5-turbo":{minOutputTokens:1,maxOutputTokens:4096,maxInputContextTokens:16385},"gpt-4o":{minOutputTokens:0,maxOutputTokens:16384,maxInputContextTokens:128e3},"gpt-4o-mini":{minOutputTokens:1,maxOutputTokens:16384,maxInputContextTokens:128e3},"kavya-m1":{minOutputTokens:0,maxOutputTokens:16384,maxInputContextTokens:128e3}},a=["en","es","hi","nl"];var l=n(901);class c extends t.Plugin{constructor(){super(...arguments),this.PLACEHOLDER_TEXT_ID="slash-placeholder",this.GPT_RESPONSE_LOADER_ID="gpt-response-loader",this.GPT_RESPONSE_ERROR_ID="gpt-error"}static get pluginName(){return"AiAgentUI"}static get requires(){return[l.Widget]}init(){try{r.uiComponent=this,this.initializeUIComponents(),this.initializeUILanguage(),this.attachListener()}catch(t){console.error(t.message)}}initializeUIComponents(){const t=this.editor,n=t.t;t.model.schema.register("inline-slash",{inheritAllFrom:"$block",isInline:!0,isObject:!0,allowWhere:"$text",allowAttributes:["class"]}),t.model.schema.extend("$text",{allowIn:"inline-slash"}),t.conversion.for("upcast").elementToElement({view:{name:"inline-slash",attributes:["class"]},model:(t,{writer:e})=>e.createElement("inline-slash",{class:t.getAttribute("class")}),converterPriority:"high"}),t.conversion.for("downcast").elementToElement({model:{name:"inline-slash",attributes:["class"]},view:(t,{writer:e})=>e.createContainerElement("inline-slash",{class:t.getAttribute("class")})}),this.addPlaceholder(),this.addLoader(),this.addGptErrorToolTip(),t.ui.componentFactory.add("aiAgentButton",(o=>{const i=new e.ButtonView(o);return i.set({label:n("Ai agent"),icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4.00815 5.01816H19.3851V10.9145H21.1594V3.2439H2.23389V22.1694H12.3955V20.3951H4.00815V5.01816Z" fill="#222330"/>\n    <path d="M15.1908 20.046L20.9028 12.7065L22.9998 14.3385L17.2878 21.678L15.0341 22.755C14.8582 22.8391 14.6619 22.6862 14.7002 22.4951L15.1908 20.046Z" fill="#222330"/>\n    <path d="M16.1211 8.43794V15.7494H14.5753V8.43794H16.1211Z" fill="#222330"/>\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M8.31458 15.7495H6.65807L9.18211 8.43804H11.1742L13.6947 15.7495H12.0382L11.4968 14.0823H8.85696L8.31458 15.7495ZM10.2067 10.1088L11.1051 12.8756H9.24951L10.1496 10.1088H10.2067Z" fill="#222330"/>\n</svg>',tooltip:!0}),i.on("execute",(()=>{this.editor.model.change((t=>{const e=this.editor.model.document.selection.getLastPosition();if(e){const n=t.createElement("inline-slash",{class:"ck-slash"});t.insertText("/",n),t.insert(n,e);const o=t.createPositionAt(n,"end");t.setSelection(o)}})),t.editing.view.focus()})),i})),t.accessibility.addKeystrokeInfos({keystrokes:[{label:n("Insert slash command (AI Agent)"),keystroke:"/"}]}),t.model.schema.register("ai-tag",{inheritAllFrom:"$block",isInline:!0,isObject:!0,allowWhere:"$block",allowAttributes:["id"]}),t.model.schema.extend("$block",{allowIn:"ai-tag"}),this.addCustomTagConversions()}addCustomTagConversions(){const t=this.editor;t.conversion.for("upcast").elementToElement({view:{name:"ai-tag",attributes:["id"]},model:(t,{writer:e})=>e.createElement("ai-tag",{id:t.getAttribute("id")})}),t.conversion.for("dataDowncast").elementToElement({model:"ai-tag",view:(t,{writer:e})=>e.createContainerElement("ai-tag",{id:t.getAttribute("id")})}),t.conversion.for("editingDowncast").elementToElement({model:"ai-tag",view:(t,{writer:e})=>{const n=e.createContainerElement("ai-tag",{id:t.getAttribute("id")});return(0,l.toWidget)(n,e)}})}initializeUILanguage(){const t=this.editor,e=t.t,n=t.locale.contentLanguage;a.includes(n)||this.showGptErrorToolTip(e("Unsupported language code"))}attachListener(){const t=this.editor,e=t.model;e.document.on("change:data",(()=>{setTimeout((()=>{this.applyPlaceholderToCurrentLine()}),10)})),e.document.selection.on("change:range",(()=>{setTimeout((()=>{this.applyPlaceholderToCurrentLine()}),10);const e=t.model.document.getRoot();if(e){const n=t.model.createRangeIn(e),o=[];for(const t of n.getItems())t.is("element","inline-slash")&&t.isEmpty&&o.push(t);t.model.change((t=>{for(const e of o)t.remove(e)}))}})),t.editing.view.document.on("scroll",(()=>{this.hidePlaceHolder()})),document.addEventListener("scroll",(()=>{this.hidePlaceHolder()}))}applyPlaceholderToCurrentLine(){var t;const e=null===(t=this.editor.model.document.selection.getFirstPosition())||void 0===t?void 0:t.parent;e&&e.isEmpty?(this.hidePlaceHolder(),setTimeout((async()=>{if(e.is("element")){const t=await this.getRectDomOfGivenModelElement(e);t&&this.showPlaceHolder(t)}}),100)):this.hidePlaceHolder()}async getRectDomOfGivenModelElement(t){const e=this.editor,n=e.editing.mapper,o=e.editing.view,i=n.toViewElement(t);if(i){const t=o.domConverter.mapViewToDom(i);if(t)return t.getBoundingClientRect()}return null}addPlaceholder(){const t=this.editor,e=t.t,n=document.createElement("p");n.id=this.PLACEHOLDER_TEXT_ID,n.onclick=()=>{t.focus()},n.classList.add("place-holder"),n.textContent=e("Type / to request AI content"),document.body.appendChild(n)}showPlaceHolder(t){const e=document.getElementById(this.PLACEHOLDER_TEXT_ID),n=this.editor.isReadOnly;e&&t&&!n?(e.classList.add("show-place-holder"),e.style.left=`${t.left}px`,e.style.top=`${t.top}px`):e&&e.classList.remove("show-place-holder")}hidePlaceHolder(){const t=document.getElementById(this.PLACEHOLDER_TEXT_ID);t&&t.classList.remove("show-place-holder")}addLoader(){const t=document.createElement("div");t.id=this.GPT_RESPONSE_LOADER_ID,t.classList.add("gpt-loader"),document.body.appendChild(t)}showLoader(t){const e=document.getElementById(this.GPT_RESPONSE_LOADER_ID);e&&t?(e.style.left=`${t.left+10}px`,e.style.top=`${t.top+10}px`,e.classList.add("show-gpt-loader")):e&&e.classList.remove("show-gpt-loader")}hideLoader(){const t=document.getElementById(this.GPT_RESPONSE_LOADER_ID);t&&t.classList.remove("show-gpt-loader")}addGptErrorToolTip(){const t=document.createElement("p");t.id=this.GPT_RESPONSE_ERROR_ID,t.classList.add("response-error"),document.body.appendChild(t)}showGptErrorToolTip(t){var e,n,o;console.log("Showing error message...",t);const i=this.editor,r=null===(o=null===(n=null===(e=null==i?void 0:i.editing)||void 0===e?void 0:e.view)||void 0===n?void 0:n.domRoots)||void 0===o?void 0:o.get("main"),s=document.getElementById(this.GPT_RESPONSE_ERROR_ID),a=null==r?void 0:r.getBoundingClientRect();s&&a&&(s.classList.add("show-response-error"),s.textContent=t,setTimeout((()=>{this.hideGptErrorToolTip()}),2e3))}hideGptErrorToolTip(){const t=document.getElementById(this.GPT_RESPONSE_ERROR_ID);t&&t.classList.remove("show-response-error")}}class d extends t.Command{constructor(t,e){super(t),this.aiAgentService=e}refresh(){this.isEnabled=!0}async execute(){await this.aiAgentService.handleSlashCommand()}}const u={blockQuote:"blockquote",caption:"figcaption",codeBlock:"pre",heading1:"h1",heading2:"h2",heading3:"h3",imageBlock:"img",imageInline:"img",paragraph:"p",table:"table",tableCell:"td",tableRow:"tr",$listItem:"li",horizontalLine:"hr"},h={bold:"strong",italic:"em",code:"code",strikethrough:"s",subscript:"sub",superscript:"sup",underline:"u",linkHref:"a"};function p(t){const e=t.model.schema.getDefinitions(),n=Object.keys(e).sort(),o=new Set;n.forEach((t=>{t in u&&o.add(u[t])}));const i=e.$text;return i&&i.allowAttributes&&i.allowAttributes.forEach((t=>{t in h&&o.add(h[t])})),o.has("li")&&(o.add("ul"),o.add("ol")),Array.from(o).sort()}var m=n(541);function g(t){return t.split("\n").map((t=>t.trimStart())).join("\n")}function f(t,e,n=!1,o){let i="",r=0;const s={preserve_whitespace:!0,html_boundaries:!0,allowed_tags:p(o)},a=m.sentences(t,s),l=n?a.reverse():a;for(const t of l){const o=t.length;if(!((r+o)/4<=e))break;i=n?t+i:i+t,r+=o}return i.trim()}function v(t){if(!t||"string"!=typeof t)return 0;const e=t.trim().replace(/\s+/g," ").match(/\b\w+('\w+)?\b|[.,!?;:"(){}[\]]/g)||[];let n=0;return e.forEach((t=>{t.length>10?n+=Math.ceil(t.length/4):n+=1})),n}function w(t,e){const n=t.split("\n");let o=0,i="";for(const t of n){const n=v(t);if(o+n>e)break;o+=n,i+=t+"\n"}return i}async function b(t){const e=t.trim();if(!/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/i.test(e))throw new Error("Invalid URL");try{const t=`https://r.jina.ai/${e.replace(/[^\x20-\x7E]/g,"").trim()}`,n=await fetch(t.trim(),{headers:{"X-With-Generated-Alt":"true"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const o=await n.text();if(o.includes("Warning: Target URL returned error"))throw new Error(`Target URL (${e}) returned an error`);if(0===o.trim().length)throw new Error("Empty content received");return o.replace(/\(https?:\/\/[^\s]+\)/g,"").replace(/^\s*$/gm,"").trim()}catch(e){return console.error(`Failed to fetch content: ${t}`,e),r.showError("Failed to fetch URL content"),""}}class y{constructor(t,e={}){var n,o,i,r,s,a,l,c,d;this.editor=t;const u=t.config.get("aiAgent");this.contextSize=null!==(n=u.contextSize)&&void 0!==n?n:4e3,this.responseOutputFormat=null!==(i=null===(o=u.promptSettings)||void 0===o?void 0:o.outputFormat)&&void 0!==i?i:[],this.responseContextData=null!==(s=null===(r=u.promptSettings)||void 0===r?void 0:r.contextData)&&void 0!==s?s:[],this.responseFilters=null!==(l=null===(a=u.promptSettings)||void 0===a?void 0:a.filters)&&void 0!==l?l:[],this.debugMode=null!==(c=u.debugMode)&&void 0!==c&&c,this.editorContextRatio=null!==(d=e.editorContextRatio)&&void 0!==d?d:.3}getSystemPrompt(t=!1){const e=[];e.push(`\n\t\t\tYou will be provided with a partially written article with \n\t\t\t"""@@@cursor@@@""" somewhere under a CONTEXT section, user input under a \n\t\t\tTASK section, and sometimes there will be articles (delimited with \n\t\t\tmarked-up language) separated by Starting Markdown Content \${number}\n\t\t\tand Ending Markdown Content \${index} with certain instructions to follow \n\t\t\twhile generating a response under an INSTRUCTION section.\n\n\t\t\tIf there is an article with """Starting Markdown Content""", your task is \n\t\t\tto use that provided information solely to respond to the user request in \n\t\t\tthe TASK section.\n\n\t\t\tFollow these step-by-step instructions to respond to user inputs:\n\t\t\t1. Analyze the CONTEXT section thoroughly to understand the existing\n\t\t\tcontent and its style\n\t\t\t2. Identify the specific requirements from the TASK section\n\t\t\t3. If markdown content is present, extract relevant information that\n\t\t\taligns with the task\n\t\t\t4. Determine the appropriate tone and style based on the context\n\t\t\t5. Generate a response that seamlessly integrates with the existing content\n\t\t\t6. Format the response according to the HTML and structural requirements\n\t\t\t7. Verify that the response meets all formatting and content guidelines\n\n\t\t\tCore Response Generation Rules:\n\t\t\t1. Replace "@@@cursor@@@" with contextually appropriate content\n\t\t\t2. Maintain consistency with the surrounding text's tone and style\n\t\t\t3. Ensure the response flows naturally with the existing content\n\t\t\t4. Avoid repeating context verbatim\n\t\t\t5. Generate original content that adds value\n\t\t\t6. Follow the specified language requirements\n\t\t\t7. Adhere to all HTML formatting rules\n\n\t\t\tLanguage and Tone Guidelines:\n\t\t\t1. Match the formality level of the surrounding content\n\t\t\t2. Maintain consistent voice throughout the response\n\t\t\t3. Use appropriate technical terminology when relevant\n\t\t\t4. Ensure proper grammar and punctuation\n\t\t\t5. Avoid overly complex sentence structures\n\t\t\t6. Keep the tone engaging and reader-friendly\n\t\t\t7. Adapt style based on content type (academic, casual, technical, etc.)\n\n\t\t\tContent Structure Rules:\n\t\t\t1. Organize information logically\n\t\t\t2. Use appropriate paragraph breaks\n\t\t\t3. Maintain consistent formatting\n\t\t\t4. Follow document hierarchy\n\t\t\t5. Use appropriate list structures when needed\n\t\t\t6. Ensure proper content flow\n\t\t\t7. Respect existing document structure\n\n\t\t\tHTML Formatting Requirements:\n\t\t\t1. Generate valid HTML snippets only\n\t\t\t2. Use only the following allowed tags: ${p(this.editor).join(", ")}\n\t\t\t3. Ensure proper tag nesting\n\t\t\t4. Avoid empty elements\n\t\t\t5. Use semantic HTML where appropriate\n\t\t\t6. Maintain clean, readable HTML structure\n\t\t\t7. Follow block-level element rules\n\t\t\t8. Properly close all tags\n\t\t\t9. No inline styles unless specified\n\t\t\t10. No script or style tags\n\t\t\t11. First word must be a valid HTML tag\n\t\t\t12. Block elements must not contain other block elements\n\t\t`),t&&e.push("\n\t\t\t\tInline Content Specific Rules:\n\t\t\t\t1. Determine content type (list, table, or inline)\n\t\t\t\t2. Format according to content type:\n\t\t\t\t   - List items: <li> within <ol> or <ul>\n\t\t\t\t   - Table cells: Plain text with <p> tags\n\t\t\t\t   - Inline content: Single <p> tag\n\t\t\t\t3. Ensure seamless integration with existing structure\n\t\t\t\t4. Maintain proper nesting\n\t\t\t\t5. Follow context-specific formatting\n\t\t\t\t6. Preserve existing content flow\n\t\t\t\t7. Match surrounding content style\n\t\t\t"),p(this.editor).includes("img")&&e.push('\n\t\t\t\tImage Element Requirements:\n\t\t\t\t1. Every <img> must have src and alt attributes\n\t\t\t\t2. Format src URLs as: https://placehold.co/600x400?text=[alt_text]\n\t\t\t\t3. Alt text requirements:\n\t\t\t\t   - Descriptive and meaningful\n\t\t\t\t   - Matches src URL text (spaces as +)\n\t\t\t\t   - No special characters\n\t\t\t\t4. Example: <img src="https://placehold.co/600x400?text=Beautiful+Sunset" alt="Beautiful Sunset">\n\t\t\t\t5. Proper image placement\n\t\t\t\t6. Contextually relevant images\n\t\t\t\t7. Appropriate image descriptions\n\t\t\t'),this.responseOutputFormat.length&&e.push(`\n\t\t\t\tOutput Format Requirements:\n\t\t\t\t${this.responseOutputFormat.join("\n")}\n\t\t\t`);const n=e.map((t=>g(t))).join("\n\n");return this.debugMode&&(console.group("AiAgent System Prompt Debug"),console.log("System Prompt:",n),console.groupEnd()),n}trimContext(t,e=""){var n,o,i,r,s;let a="",l="";const c=null!=e?e:t,d=null===(r=null===(i=null===(o=null===(n=this.editor)||void 0===n?void 0:n.editing)||void 0===o?void 0:o.view)||void 0===i?void 0:i.domRoots)||void 0===r?void 0:r.get("main"),u=null!==(s=null==d?void 0:d.innerText)&&void 0!==s?s:"",h=u.indexOf(c),p=u.indexOf("\n",h),m=-1!==p?p:h+c.length,g=[u.substring(0,m),u.substring(m+1)],v=Math.floor(this.contextSize*this.editorContextRatio);g.length>1&&(g[0].length<g[1].length?(a=f(g[0],v/2,!0,this.editor),l=f(g[1],v-a.length/4,!1,this.editor)):(l=f(g[1],v/2,!1,this.editor),a=f(g[0],v-l.length/4,!0,this.editor)));const w=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");a=a.trim().replace(new RegExp(w.slice(1)),"@@@cursor@@@");return`${a}\n${l}`.trim()}formatFinalPrompt(t,e,n,o){this.debugMode&&(console.group("formatFinalPrompt Debug"),console.log("Request:",t),console.log("Context:",e),console.log("MarkDownContents:",n),console.log("IsEditorEmpty:",o));const i=this.editor.locale.contentLanguage,r=[];return o||r.push(`CONTEXT:\n"""\n${e}\n"""\n`),r.push(`TASK:\n"""\n${t}\n"""\n`),n.length&&(r.push(`\n\t\t\t\tRefer to following markdown content as a source of information, \n\t\t\t\tbut generate new text that fits the given context & task.\n\n\t\t\t\t${n.map(((t,e)=>`\n\t\t\t\t\t------------ Starting Markdown Content ${e+1} ------------\n\t\t\t\t\t${t.content}\n\t\t\t\t\t------------ Ending Markdown Content ${e+1} ------------\n\t\t\t\t`)).join("\n")}\n\t\t\t`),r.push("\n\t\t\t\tMarkdown Content Guidelines:\n\t\t\t\t1. Use information from provided markdown to generate new text\n\t\t\t\t2. Do not copy content verbatim\n\t\t\t\t3. Ensure natural flow with existing context\n\t\t\t\t4. Avoid markdown formatting in response\n\t\t\t\t5. Consider whole markdown as single source\n\t\t\t\t6. Generate requested percentage of content\n\t\t\t")),r.push("\nINSTRUCTIONS:\n"),r.push(`The response must follow the language code - ${i}.`),this.responseOutputFormat.length&&r.push(`\n\t\t\t\tOutput Format Requirements:\n\t\t\t\t${this.responseOutputFormat.join("\n")}\n\t\t\t`),this.responseFilters.length?r.push(...this.responseFilters):r.push("The response should directly follow the context, avoiding any awkward transitions or noticeable gaps."),o||r.push("\n\t\t\t\tContext Integration Requirements:\n\t\t\t\t1. Maintain seamless connection with surrounding text\n\t\t\t\t2. Ensure smooth and natural transitions\n\t\t\t\t3. Do not modify original text except @@@cursor@@@ replacement\n\t\t\t\t4. Match existing style and tone\n\t\t\t\t5. Preserve document structure\n\t\t\t"),this.responseContextData.length&&r.push(...this.responseContextData),this.debugMode&&(console.group("AiAgent Final Prompt Debug"),console.log("Final Prompt:",r.join("\n")),console.groupEnd()),r.map((t=>g(t))).join("\n")}async generateMarkDownForUrls(t){try{const e=[];for(const n of t)try{const t=await b(n);t&&e.push({content:t,url:n,tokenCount:v(t)})}catch(t){this.debugMode&&console.error(`Failed to fetch content from ${n}:`,t),r.showError(`Failed to fetch content from ${n}`)}return this.allocateTokensToFetchedContent(this.getSystemPrompt(),e)}catch(t){return this.debugMode&&console.error("Error generating markdown content:",t),r.showError("Failed to generate markdown content"),[]}}allocateTokensToFetchedContent(t,e){var n,o,i,r,s,a;const l=null!==(a=null===(s=null===(r=null===(i=null===(o=null===(n=this.editor)||void 0===n?void 0:n.editing)||void 0===o?void 0:o.view)||void 0===i?void 0:i.domRoots)||void 0===r?void 0:r.get("main"))||void 0===s?void 0:s.innerText)&&void 0!==a?a:"",c=Math.min(Math.floor(this.contextSize*this.editorContextRatio),v(l)),d=this.contextSize-c;if(0===d||!e.length)return e;const u=Math.floor(d/e.length);return e.map((t=>({...t,content:w(t.content,u)})))}}class x{constructor(t){var e;this.editor=t,this.model=t.model,this.debugMode=null!==(e=t.config.get("aiAgent.debugMode"))&&void 0!==e&&e}async insertSimpleHtml(t){var e;this.debugMode&&console.log("Attempting to insert simple HTML:",t);const n=this.editor.data.processor.toView(t),o=this.editor.data.toModel(n,"$root"),i=this.model.document.selection,r=this.model.document.getRoot();let s=i.getLastPosition();const a=o.getChild(o.childCount-1),l=null===(e=i.getLastPosition())||void 0===e?void 0:e.path[0],c=null==r?void 0:r.getChild(null!=l?l:0);this.model.change((t=>{if((null==c?void 0:c.is("element"))&&(s=c.isEmpty?t.createPositionAt(c,"end"):t.createPositionAfter(c)),s&&r){t.setSelection(s),this.model.insertContent(o,s);let e=null==a?void 0:a.getAttribute("listItemId");if((null==a?void 0:a.is("element"))&&(e=e||"table"===a.name),e&&a){const e=t.createElement("paragraph");t.insert(e,t.createPositionAfter(a)),t.setSelection(e,"in")}else a&&t.setSelection(t.createPositionAfter(a))}})),await new Promise((t=>setTimeout(t,100)))}async insertAsText(t,e,n=!1,o=!1){const i=this.editor.data.processor.toView(t.outerHTML),r=this.editor.data.toModel(i,"$root"),s=Array.from(r.getChildren()),a=this.model.document.getRoot();for(const[t,o]of s.entries())if(o.is("element")){const i=0===t?e:void 0;n?await this.insertElementAsStream(o,i):await this.batchInsertOfElement(o,i)}o&&this.model.change((t=>{const e=this.model.document.selection.getLastPosition(),n=null==e?void 0:e.path[0];if(a&&null!=n){const e=t.createElement("paragraph");t.insert(e,a,n+1),t.setSelection(e,"in")}}))}async batchInsertOfElement(t,e){var n;const o=this.model.document.selection,i=this.model.document.getRoot();let r=e;if(!e){const t=null===(n=o.getFirstPosition())||void 0===n?void 0:n.path[0],e=null==i?void 0:i.getChild(null!=t?t:0);(null==e?void 0:e.is("element"))&&(r=e.isEmpty?this.model.createPositionAt(e,"end"):this.model.createPositionAfter(e))}this.model.change((e=>{this.model.insertContent(t,r),e.setSelection(t,"end")}))}async insertElementAsStream(t,e){const n=this.model.document.selection,o=this.model.document.getRoot(),i=n.getLastPosition();let r,s=e;if(e){const t=null==i?void 0:i.parent;(null==t?void 0:t.is("element"))&&(r=t)}else{const e=null==i?void 0:i.path[0],n=null==o?void 0:o.getChild(null!=e?e:0);(null==n?void 0:n.is("element"))&&(s=n.isEmpty?this.model.createPositionAt(n,"end"):this.model.createPositionAfter(n)),this.model.change((e=>{r=e.createElement(t.name);for(const[e,n]of t.getAttributes())r._setAttribute(e,n);this.model.insertContent(r,s),s&&e.setSelection(r,"end")}))}const a=Array.from(t.getChildren()).filter((t=>t.is("$text")));for(const t of a){if(!t.is("$text"))continue;const e=Array.from(t.getAttributes()),n=t._data;for(const t of n)await new Promise((n=>{this.model.change((n=>{const o=this.editor.model.document.selection.getLastPosition(),i=o.getShiftedBy(1).offset===(null==o?void 0:o.parent.maxOffset);n.insertText(t,e,r,i?"end":null==o?void 0:o.offset),n.setSelection(this.editor.model.document.selection.getLastPosition())})),setTimeout(n,5)}))}e||this.model.change((t=>{t.setSelection(r,"end")}))}isCompleteHtmlChunk(t){if((t.match(/<[^/][^>]*>/g)||[]).length!==(t.match(/<\/[^>]+>/g)||[]).length)return!1;if(t.includes("<")&&!t.includes(">"))return!1;const e=t.trim();return!(!e.startsWith("<")||!e.endsWith(">"))}}class T{constructor(t){var e,n,o;this.aiAgentFeatureLockId=Symbol("ai-agent-feature"),this.buffer="",this.openTags=[],this.isInlineInsertion=!1,this.editor=t,this.promptHelper=new y(t),this.htmlParser=new x(t);const i=t.config.get("aiAgent");this.aiModel=i.model,this.apiKey=i.apiKey,this.endpointUrl=i.endpointUrl,this.temperature=i.temperature,this.timeOutDuration=null!==(e=i.timeOutDuration)&&void 0!==e?e:45e3,this.maxTokens=null!==(n=i.maxOutputTokens)&&void 0!==n?n:i.maxTokens,this.retryAttempts=i.retryAttempts,this.stopSequences=i.stopSequences,this.streamContent=null===(o=i.streamContent)||void 0===o||o}async handleSlashCommand(){const t=this.editor,e=t.model,n=t.editing.mapper,o=t.editing.view,i=e.document.getRoot();let s,a,l;const c=e.document.selection.getLastPosition();if(c&&i){l=c.parent;const t="inline-slash"===l.name?l:void 0,r=n.toViewElement(l);if(a=r?o.domConverter.mapViewToDom(r):void 0,t){this.isInlineInsertion=!0;const n=t.getPath(),l=null==c?void 0:c.path,d=e.createPositionFromPath(i,n),u=e.createPositionFromPath(i,l),h=e.createRange(d,u);a=(null==r?void 0:r.parent)?o.domConverter.mapViewToDom(r.parent):void 0,s="";for(const t of h.getItems())t.is("$textProxy")&&(s+=t.data.trim())}else a&&(s=null==a?void 0:a.innerText)}try{const t=window.getSelection(),e=(null==t?void 0:t.getRangeAt(0)).getBoundingClientRect();r.showLoader(e);const n=await this.generateGptPromptBasedOnUserPrompt(null!=s?s:"",null==a?void 0:a.innerText);l&&n&&await this.fetchAndProcessGptResponse(n,l)}catch(t){throw console.error("Error handling slash command:",t),t}finally{this.isInlineInsertion=!1,r.hideLoader()}}async fetchAndProcessGptResponse(t,e,n=this.retryAttempts){var o,i,s;console.log("Starting fetchAndProcessGptResponse");const a=this.editor,l=a.t,c=new AbortController,d=setTimeout((()=>c.abort()),this.timeOutDuration);let u="",h="";const p=`ai-${(new Date).getTime()}`;try{const n=await fetch(this.endpointUrl,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:this.aiModel,messages:[{role:"system",content:this.promptHelper.getSystemPrompt(this.isInlineInsertion)},{role:"user",content:t}],temperature:this.temperature,max_tokens:this.maxTokens,stop:this.stopSequences,stream:!0}),signal:c.signal});if(clearTimeout(d),!n.ok)throw new Error("Fetch failed");r.hideLoader();const s=n.body.getReader(),l=new TextDecoder("utf-8");this.clearParentContent(e),this.editor.enableReadOnlyMode(this.aiAgentFeatureLockId);let m=!0;for(a.model.change((t=>{var e;const n=a.model.document.selection.getLastPosition();if(n){const o=t.createElement("ai-tag",{id:p}),i=n.parent;i&&("tableCell"===(null===(e=i.parent)||void 0===e?void 0:e.name)||"bulleted"===i.getAttribute("listType"))&&(m=!1);let r="";for(const t of i.getChildren())t.is("$text")&&(r+=t.data);const s=r?t.createPositionAfter(i):t.createPositionBefore(i);t.insert(o,m?s:n);const a=t.createPositionAt(o,"end");t.setSelection(a)}})),console.log("Starting to process response");;){const{done:t,value:e}=await s.read();if(t){console.log("Finished reading response");break}let n;for(u+=l.decode(e,{stream:!0});-1!==(n=u.indexOf("\n"));){const t=u.slice(0,n).trim();if(u=u.slice(n+1),t.startsWith("data: ")){const e=t.slice(5).trim();if("[DONE]"===e){console.log("Received [DONE] signal");break}try{const t=null===(i=null===(o=JSON.parse(e).choices[0])||void 0===o?void 0:o.delta)||void 0===i?void 0:i.content;null!=t&&(h+=t),await this.updateContent(h,p,m)}catch(t){console.warn("Error parsing JSON:",t)}}}}let g=a.getData().replace(`<ai-tag id="${p}">`,"");g=g.replace("</ai-tag>",""),a.setData(g)}catch(o){console.error("Error in fetchAndProcessGptResponse:",o);const i=((null==o?void 0:o.message)||"").trim()||((null==o?void 0:o.name)||"").trim(),a=["AbortError","ReadableStream not supported","AiAgent: Fetch failed"].includes(i);if(n>0&&a)return console.warn(`Retrying... (${n} attempts left)`),await this.fetchAndProcessGptResponse(t,e,n-1);let c;if("ReadableStream not supported"===((null==o?void 0:o.name)||(null===(s=null==o?void 0:o.message)||void 0===s?void 0:s.trim())))c=l("Browser does not support readable streams");else c=l("We couldn't connect to the AI. Please check your internet");r.showError(c)}finally{this.editor.disableReadOnlyMode(this.aiAgentFeatureLockId)}}async updateContent(t,e,n){const o=this.editor;o.model.change((i=>{const r=o.model.document.getRoot();let s=null;if(r){for(const t of r.getChildren()){const o=t;if(n){if(o.is("element","ai-tag")&&o.getAttribute("id")===e){s=o;break}}else for(const t of o.getChildren())if(t.is("element","ai-tag")&&t.getAttribute("id")===e){s=t;break}}if(s){const e=o.model.createRangeIn(s);i.remove(e);const n=o.data.processor.toView(t),r=o.data.toModel(n);i.insert(r,s,"end")}}})),await new Promise((t=>setTimeout(t)))}async processContent(t){try{if(console.log("--- Start of processContent ---"),console.log("Processing content:",t,this.isInlineInsertion),this.isInlineInsertion){const e=this.editor.model.document.selection.getLastPosition(),n=document.createElement("div");n.innerHTML=t,await this.htmlParser.insertAsText(n||"",null!=e?e:void 0,this.streamContent)}else this.streamContent?await this.proceedHtmlResponse(t):await this.htmlParser.insertSimpleHtml(t);console.log("--- End of processContent ---")}catch(t){console.error(t)}}async proceedHtmlResponse(t){const e=document.createElement("div");e.innerHTML=t;for(const t of Array.from(e.childNodes)){const e=t;if(e.nodeType===Node.ELEMENT_NODE){const t=e.tagName.toLowerCase();["table","blockquote","pre","img","form","figure"].includes(t)?await this.htmlParser.insertSimpleHtml(e.outerHTML):"ul"===t||"ol"===t?await this.htmlParser.insertAsText(e,void 0,!0,!0):await this.htmlParser.insertAsText(e,void 0,!0)}else if(e.nodeType===Node.TEXT_NODE&&e.textContent){const t=document.createElement("div");t.innerText=e.textContent,await this.htmlParser.insertAsText(t,void 0,!0)}}}clearParentContent(t){const e=this.editor,n=e.model,o=n.document.getRoot(),i=n.document.selection.getLastPosition(),r=Array.from(t.getChildren()).find((t=>"inline-slash"===t.name));o&&i&&e.model.change((e=>{const s=(null==r?void 0:r.getPath())||t.getPath(),a=n.createRange(n.createPositionFromPath(o,s),n.createPositionFromPath(o,i.path));e.remove(a),e.setSelection(n.createPositionFromPath(o,s))}))}async generateGptPromptBasedOnUserPrompt(t,e){try{const n=this.promptHelper.trimContext(t,e),o=t.slice(1);let i=[];const r=/https?:\/\/[^\s/$.?#].[^\s]*/g,s=t.match(r);if(Array.isArray(s)&&s.length){const e=s.map((t=>t.replace(/[,.]$/,"")));i=await this.promptHelper.generateMarkDownForUrls(e),i=this.promptHelper.allocateTokensToFetchedContent(t,i)}const a='"@@@cursor@@@"'===n;return this.promptHelper.formatFinalPrompt(o,n,i,a)}catch(t){return console.error(t),null}}}class A extends t.Plugin{static get pluginName(){return"AiAgentEditing"}init(){const t=this.editor,e=new T(t);t.commands.add("aiAgent",new d(t,e)),this.setupEnterKeyHandling()}setupEnterKeyHandling(){const t=this.editor,e=t.model,n=t.editing.mapper,o=t.editing.view;t.keystrokes.set("enter",(async(i,r)=>{var s;const a=e.document.selection.getFirstPosition();if(a){const e=a.parent,i=Array.from(e.getChildren()).find((t=>"inline-slash"===t.name)),l=n.toViewElement(e);let c;l&&(c=null===(s=o.domConverter.mapViewToDom(l))||void 0===s?void 0:s.innerText),("string"==typeof c&&c.startsWith("/")||i)&&(r(),await t.execute("aiAgent"))}}))}}var E=n(72),C=n.n(E),P=n(346),S={injectType:"singletonStyleTag",attributes:{"data-cke":!0},insert:"head",singleton:!0};C()(P.A,S);P.A.locals;class k extends t.Plugin{constructor(t){super(t),this.DEFAULT_GPT_MODEL="gpt-4o",this.DEFAULT_AI_END_POINT="https://api.openai.com/v1/chat/completions";const e=t.config.get("aiAgent")||{},n={...{model:this.DEFAULT_GPT_MODEL,apiKey:"",endpointUrl:this.DEFAULT_AI_END_POINT,temperature:void 0,timeOutDuration:45e3,maxOutputTokens:s[this.DEFAULT_GPT_MODEL].maxOutputTokens,maxInputTokens:s[this.DEFAULT_GPT_MODEL].maxInputContextTokens,retryAttempts:1,contextSize:.75*s[this.DEFAULT_GPT_MODEL].maxInputContextTokens,stopSequences:[],promptSettings:{outputFormat:[],contextData:[],filters:[]},debugMode:!1,streamContent:!0},...e};t.config.set("aiAgent",n),this.validateConfiguration(n)}static get requires(){return[c,A]}static get pluginName(){return"AiAgent"}validateConfiguration(t){if(!t.apiKey)throw new Error("AiAgent: apiKey is required.");if(t.temperature&&(t.temperature<0||t.temperature>2))throw new Error("AiAgent: Temperature must be a number between 0 and 2.");const e=s[t.model];if(void 0!==t.maxOutputTokens&&(t.maxOutputTokens<e.minOutputTokens||t.maxOutputTokens>e.maxOutputTokens))throw new Error(`AiAgent: maxOutputTokens must be between ${e.minOutputTokens} and ${e.maxOutputTokens} for ${t.model}`);if(void 0!==t.maxInputTokens&&t.maxInputTokens>e.maxInputContextTokens)throw new Error(`AiAgent: maxInputTokens cannot exceed ${e.maxInputContextTokens} for ${t.model}`)}init(){}}const L={ckeditor:"<svg width='68' height='64' viewBox='0 0 68 64' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M43.71 11.025a11.508 11.508 0 0 0-1.213 5.159c0 6.42 5.244 11.625 11.713 11.625.083 0 .167 0 .25-.002v16.282a5.464 5.464 0 0 1-2.756 4.739L30.986 60.7a5.548 5.548 0 0 1-5.512 0L4.756 48.828A5.464 5.464 0 0 1 2 44.089V20.344c0-1.955 1.05-3.76 2.756-4.738L25.474 3.733a5.548 5.548 0 0 1 5.512 0l12.724 7.292z' fill='#FFF'/><path d='M45.684 8.79a12.604 12.604 0 0 0-1.329 5.65c0 7.032 5.744 12.733 12.829 12.733.091 0 .183-.001.274-.003v17.834a5.987 5.987 0 0 1-3.019 5.19L31.747 63.196a6.076 6.076 0 0 1-6.037 0L3.02 50.193A5.984 5.984 0 0 1 0 45.003V18.997c0-2.14 1.15-4.119 3.019-5.19L25.71.804a6.076 6.076 0 0 1 6.037 0L45.684 8.79zm-29.44 11.89c-.834 0-1.51.671-1.51 1.498v.715c0 .828.676 1.498 1.51 1.498h25.489c.833 0 1.51-.67 1.51-1.498v-.715c0-.827-.677-1.498-1.51-1.498h-25.49.001zm0 9.227c-.834 0-1.51.671-1.51 1.498v.715c0 .828.676 1.498 1.51 1.498h18.479c.833 0 1.509-.67 1.509-1.498v-.715c0-.827-.676-1.498-1.51-1.498H16.244zm0 9.227c-.834 0-1.51.671-1.51 1.498v.715c0 .828.676 1.498 1.51 1.498h25.489c.833 0 1.51-.67 1.51-1.498v-.715c0-.827-.677-1.498-1.51-1.498h-25.49.001zm41.191-14.459c-5.835 0-10.565-4.695-10.565-10.486 0-5.792 4.73-10.487 10.565-10.487C63.27 3.703 68 8.398 68 14.19c0 5.791-4.73 10.486-10.565 10.486v-.001z' fill='#1EBC61' fill-rule='nonzero'/><path d='M60.857 15.995c0-.467-.084-.875-.251-1.225a2.547 2.547 0 0 0-.686-.88 2.888 2.888 0 0 0-1.026-.531 4.418 4.418 0 0 0-1.259-.175c-.134 0-.283.006-.447.018-.15.01-.3.034-.446.07l.075-1.4h3.587v-1.8h-5.462l-.214 5.06c.319-.116.682-.21 1.089-.28.406-.071.77-.107 1.088-.107.218 0 .437.021.655.063.218.041.413.114.585.218s.313.244.422.419c.109.175.163.391.163.65 0 .424-.132.745-.396.961a1.434 1.434 0 0 1-.938.325c-.352 0-.656-.1-.912-.3-.256-.2-.43-.453-.523-.762l-1.925.588c.1.35.258.664.472.943.214.279.47.514.767.706.298.191.63.339.995.443.365.104.749.156 1.151.156.437 0 .86-.064 1.272-.193.41-.13.778-.323 1.1-.581a2.8 2.8 0 0 0 .775-.981c.193-.396.29-.864.29-1.405h-.001z' fill='#FFF' fill-rule='nonzero'/></g></svg>\n"}})(),(window.CKEditor5=window.CKEditor5||{}).aiAgent=o})();